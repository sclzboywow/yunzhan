{"openapi":"3.1.0","info":{"title":"NetDisk Backend","version":"0.1.0"},"paths":{"/health":{"get":{"tags":["system"],"summary":"Health","operationId":"health_health_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/auth/me":{"get":{"tags":["auth"],"summary":"Me","operationId":"me_auth_me_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserOut"}}}}},"security":[{"HTTPBearer":[]}]}},"/auth/register":{"post":{"tags":["auth"],"summary":"Register","operationId":"register_auth_register_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/RegisterRequest"}}},"required":true},"responses":{"201":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserOut"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/auth/login":{"post":{"tags":["auth"],"summary":"Login","operationId":"login_auth_login_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/LoginRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/TokenResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/auth/refresh":{"post":{"tags":["auth"],"summary":"Refresh Token","description":"使用refresh token获取新的access token","operationId":"refresh_token_auth_refresh_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/RefreshTokenRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/TokenResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/auth/set_role":{"post":{"tags":["auth"],"summary":"Set Role","operationId":"set_role_auth_set_role_post","parameters":[{"name":"username","in":"query","required":true,"schema":{"type":"string","title":"Username"}},{"name":"role","in":"query","required":true,"schema":{"type":"string","title":"Role"}},{"name":"admin_secret","in":"query","required":true,"schema":{"type":"string","title":"Admin Secret"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"object","additionalProperties":true,"title":"Response Set Role Auth Set Role Post"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/ws/broadcast":{"post":{"summary":"Ws Broadcast","operationId":"ws_broadcast_ws_broadcast_post","parameters":[{"name":"admin_secret","in":"query","required":true,"schema":{"type":"string","title":"Admin Secret"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","additionalProperties":true,"title":"Message"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/mcp/user/quota":{"get":{"tags":["mcp"],"summary":"User Quota","operationId":"user_quota_mcp_user_quota_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}},"security":[{"HTTPBearer":[]}]}},"/mcp/user/list":{"get":{"tags":["mcp"],"summary":"User List Files","operationId":"user_list_files_mcp_user_list_get","security":[{"HTTPBearer":[]}],"parameters":[{"name":"dir","in":"query","required":false,"schema":{"type":"string","default":"/","title":"Dir"}},{"name":"limit","in":"query","required":false,"schema":{"type":"integer","default":100,"title":"Limit"}},{"name":"order","in":"query","required":false,"schema":{"type":"string","default":"time","title":"Order"}},{"name":"desc","in":"query","required":false,"schema":{"type":"integer","default":1,"title":"Desc"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/mcp/public/quota":{"get":{"tags":["mcp"],"summary":"Public Quota","operationId":"public_quota_mcp_public_quota_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}},"security":[{"HTTPBearer":[]}]}},"/mcp/public/list":{"get":{"tags":["mcp"],"summary":"Public List Files","operationId":"public_list_files_mcp_public_list_get","security":[{"HTTPBearer":[]}],"parameters":[{"name":"dir","in":"query","required":false,"schema":{"type":"string","default":"/","title":"Dir"}},{"name":"limit","in":"query","required":false,"schema":{"type":"integer","default":100,"title":"Limit"}},{"name":"order","in":"query","required":false,"schema":{"type":"string","default":"time","title":"Order"}},{"name":"desc","in":"query","required":false,"schema":{"type":"integer","default":1,"title":"Desc"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/mcp/public/exec":{"post":{"tags":["mcp"],"summary":"Public Exec","operationId":"public_exec_mcp_public_exec_post","requestBody":{"content":{"application/json":{"schema":{"additionalProperties":true,"type":"object","title":"Payload"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"HTTPBearer":[]}]}},"/mcp/user/exec":{"post":{"tags":["mcp"],"summary":"User Exec","operationId":"user_exec_mcp_user_exec_post","requestBody":{"content":{"application/json":{"schema":{"additionalProperties":true,"type":"object","title":"Payload"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"HTTPBearer":[]}]}},"/oauth/device/start":{"post":{"tags":["oauth"],"summary":"Device Start","operationId":"device_start_oauth_device_start_post","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}},"security":[{"HTTPBearer":[]}]}},"/oauth/device/poll":{"post":{"tags":["oauth"],"summary":"Device Poll","operationId":"device_poll_oauth_device_poll_post","security":[{"HTTPBearer":[]}],"parameters":[{"name":"device_code","in":"query","required":true,"schema":{"type":"string","title":"Device Code"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/oauth/token":{"get":{"tags":["oauth"],"summary":"Token Masked","operationId":"token_masked_oauth_token_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}},"security":[{"HTTPBearer":[]}]}},"/oauth/service/device/start":{"post":{"tags":["oauth"],"summary":"Service Device Start","operationId":"service_device_start_oauth_service_device_start_post","security":[{"HTTPBearer":[]}],"parameters":[{"name":"admin_secret","in":"query","required":true,"schema":{"type":"string","title":"Admin Secret"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/oauth/service/device/poll":{"post":{"tags":["oauth"],"summary":"Service Device Poll","operationId":"service_device_poll_oauth_service_device_poll_post","security":[{"HTTPBearer":[]}],"parameters":[{"name":"device_code","in":"query","required":true,"schema":{"type":"string","title":"Device Code"}},{"name":"admin_secret","in":"query","required":true,"schema":{"type":"string","title":"Admin Secret"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/oauth/callback":{"get":{"tags":["oauth"],"summary":"Oauth Callback","description":"统一回调：通过 state 区分 user / service。\n\n- state == 'service' → 作为服务账户令牌保存\n- 其他或空 → 保存为当前用户令牌","operationId":"oauth_callback_oauth_callback_get","parameters":[{"name":"code","in":"query","required":true,"schema":{"type":"string","title":"Code"}},{"name":"state","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"State"}}],"responses":{"200":{"description":"Successful Response","content":{"text/html":{"schema":{"type":"string"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/oauth/service/callback":{"get":{"tags":["oauth"],"summary":"Oauth Service Callback Compat","operationId":"oauth_service_callback_compat_oauth_service_callback_get","parameters":[{"name":"code","in":"query","required":true,"schema":{"type":"string","title":"Code"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/oauth/service/token":{"get":{"tags":["oauth"],"summary":"Service Token Masked","operationId":"service_token_masked_oauth_service_token_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}},"security":[{"HTTPBearer":[]}]}},"/oauth/service/token/raw":{"get":{"tags":["oauth"],"summary":"Service Token Raw","description":"Return unmasked service (public) token. Admin secret required.","operationId":"service_token_raw_oauth_service_token_raw_get","parameters":[{"name":"admin_secret","in":"query","required":true,"schema":{"type":"string","title":"Admin Secret"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/oauth/user/token/upsert":{"post":{"tags":["oauth"],"summary":"User Token Upsert","description":"Persist user-provided tokens for later server-side MCP execution.\n\nBody form or JSON fields: access_token, refresh_token?, expires_in?","operationId":"user_token_upsert_oauth_user_token_upsert_post","security":[{"HTTPBearer":[]}],"parameters":[{"name":"access_token","in":"query","required":true,"schema":{"type":"string","title":"Access Token"}},{"name":"refresh_token","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Refresh Token"}},{"name":"expires_in","in":"query","required":false,"schema":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Expires In"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/oauth/device/start_auto":{"post":{"tags":["oauth"],"summary":"Device Start Auto","description":"启动自动授权流程，无需JWT认证","operationId":"device_start_auto_oauth_device_start_auto_post","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/oauth/device/poll_auto":{"post":{"tags":["oauth"],"summary":"Device Poll Auto","description":"轮询自动授权状态，自动创建用户账号","operationId":"device_poll_auto_oauth_device_poll_auto_post","parameters":[{"name":"device_code","in":"query","required":true,"schema":{"type":"string","title":"Device Code"}},{"name":"device_fingerprint","in":"query","required":false,"schema":{"type":"string","title":"Device Fingerprint"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/admin/quota":{"get":{"tags":["admin"],"summary":"Quota Get","operationId":"quota_get_admin_quota_get","parameters":[{"name":"username","in":"query","required":true,"schema":{"type":"string","title":"Username"}},{"name":"admin_secret","in":"query","required":true,"schema":{"type":"string","title":"Admin Secret"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/admin/quota/reset":{"post":{"tags":["admin"],"summary":"Quota Reset","operationId":"quota_reset_admin_quota_reset_post","parameters":[{"name":"username","in":"query","required":true,"schema":{"type":"string","title":"Username"}},{"name":"day","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Day"}},{"name":"admin_secret","in":"query","required":true,"schema":{"type":"string","title":"Admin Secret"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/admin/tickets":{"get":{"tags":["admin"],"summary":"Tickets List","operationId":"tickets_list_admin_tickets_get","parameters":[{"name":"admin_secret","in":"query","required":true,"schema":{"type":"string","title":"Admin Secret"}},{"name":"scope","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Scope"}},{"name":"consumed","in":"query","required":false,"schema":{"anyOf":[{"type":"boolean"},{"type":"null"}],"title":"Consumed"}},{"name":"page","in":"query","required":false,"schema":{"type":"integer","default":1,"title":"Page"}},{"name":"page_size","in":"query","required":false,"schema":{"type":"integer","default":100,"title":"Page Size"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/admin/tickets/revoke":{"post":{"tags":["admin"],"summary":"Tickets Revoke","operationId":"tickets_revoke_admin_tickets_revoke_post","parameters":[{"name":"jti","in":"query","required":true,"schema":{"type":"string","title":"Jti"}},{"name":"admin_secret","in":"query","required":true,"schema":{"type":"string","title":"Admin Secret"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/admin/tickets/gc":{"post":{"tags":["admin"],"summary":"Tickets Gc","operationId":"tickets_gc_admin_tickets_gc_post","parameters":[{"name":"admin_secret","in":"query","required":true,"schema":{"type":"string","title":"Admin Secret"}},{"name":"keep_days","in":"query","required":false,"schema":{"type":"integer","default":7,"title":"Keep Days"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/quota/today":{"get":{"tags":["quota"],"summary":"Quota Today","operationId":"quota_today_quota_today_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}},"security":[{"HTTPBearer":[]}]}},"/reports/public":{"post":{"tags":["reports"],"summary":"Report Public","operationId":"report_public_reports_public_post","security":[{"HTTPBearer":[]}],"parameters":[{"name":"target","in":"query","required":true,"schema":{"type":"string","maxLength":512,"description":"单个被举报对象标识（推荐 fsid）","title":"Target"},"description":"单个被举报对象标识（推荐 fsid）"},{"name":"reason","in":"query","required":true,"schema":{"type":"string","maxLength":1024,"description":"举报原因（简述）","title":"Reason"},"description":"举报原因（简述）"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/reports/public/count":{"get":{"tags":["reports"],"summary":"Report Public Count","operationId":"report_public_count_reports_public_count_get","parameters":[{"name":"target","in":"query","required":true,"schema":{"type":"string","maxLength":512,"title":"Target"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/upload":{"post":{"tags":["upload"],"summary":"Upload Public","operationId":"upload_public_upload_post","requestBody":{"content":{"multipart/form-data":{"schema":{"$ref":"#/components/schemas/Body_upload_public_upload_post"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"HTTPBearer":[]}]}},"/files/dedup/md5":{"get":{"tags":["文件管理"],"summary":"按MD5查重（存在则返回样本列表）","operationId":"dedup_by_md5_files_dedup_md5_get","security":[{"HTTPBearer":[]}],"parameters":[{"name":"md5","in":"query","required":true,"schema":{"type":"string","minLength":16,"maxLength":64,"description":"文件MD5","title":"Md5"},"description":"文件MD5"},{"name":"sample_limit","in":"query","required":false,"schema":{"type":"integer","maximum":20,"minimum":1,"description":"返回样本条数上限","default":5,"title":"Sample Limit"},"description":"返回样本条数上限"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/files/list":{"get":{"tags":["文件管理"],"summary":"获取文件列表","description":"获取文件列表，支持分页和多条件过滤\n\n- **page**: 页码，从1开始\n- **page_size**: 每页数量，最大1000\n- **file_path**: 文件路径过滤，支持模糊匹配\n- **category**: 文件类别过滤\n- **file_size_min**: 最小文件大小（字节）\n- **file_size_max**: 最大文件大小（字节）\n- **status**: 文件状态过滤\n- **order_by**: 排序字段（id, file_name, file_path, file_size, create_time, modify_time, export_time）\n- **order_desc**: 是否降序排列","operationId":"get_file_list_files_list_get","security":[{"HTTPBearer":[]}],"parameters":[{"name":"page","in":"query","required":false,"schema":{"type":"integer","minimum":1,"description":"页码，从1开始","default":1,"title":"Page"},"description":"页码，从1开始"},{"name":"page_size","in":"query","required":false,"schema":{"type":"integer","maximum":1000,"minimum":1,"description":"每页数量，最大1000","default":1000,"title":"Page Size"},"description":"每页数量，最大1000"},{"name":"file_path","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"description":"文件路径过滤，支持模糊匹配","title":"File Path"},"description":"文件路径过滤，支持模糊匹配"},{"name":"category","in":"query","required":false,"schema":{"anyOf":[{"type":"integer"},{"type":"null"}],"description":"文件类别过滤","title":"Category"},"description":"文件类别过滤"},{"name":"file_size_min","in":"query","required":false,"schema":{"anyOf":[{"type":"integer","minimum":0},{"type":"null"}],"description":"最小文件大小（字节）","title":"File Size Min"},"description":"最小文件大小（字节）"},{"name":"file_size_max","in":"query","required":false,"schema":{"anyOf":[{"type":"integer","minimum":0},{"type":"null"}],"description":"最大文件大小（字节）","title":"File Size Max"},"description":"最大文件大小（字节）"},{"name":"status","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"description":"文件状态过滤","title":"Status"},"description":"文件状态过滤"},{"name":"order_by","in":"query","required":false,"schema":{"type":"string","description":"排序字段","default":"id","title":"Order By"},"description":"排序字段"},{"name":"order_desc","in":"query","required":false,"schema":{"type":"boolean","description":"是否降序排列","default":true,"title":"Order Desc"},"description":"是否降序排列"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/FileListResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/files/stats":{"get":{"tags":["文件管理"],"summary":"获取文件统计信息","description":"获取文件统计信息，包括总数、大小、分类统计等","operationId":"get_file_stats_files_stats_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/FileStatsResponse"}}}}},"security":[{"HTTPBearer":[]}]}},"/files/search":{"get":{"tags":["文件管理"],"summary":"搜索文件","description":"根据关键词搜索文件（文件名或路径）","operationId":"search_files_files_search_get","security":[{"HTTPBearer":[]}],"parameters":[{"name":"keyword","in":"query","required":true,"schema":{"type":"string","description":"搜索关键词","title":"Keyword"},"description":"搜索关键词"},{"name":"limit","in":"query","required":false,"schema":{"type":"integer","maximum":1000,"minimum":1,"description":"返回结果数量限制","default":100,"title":"Limit"},"description":"返回结果数量限制"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/FileInfo"},"title":"Response Search Files Files Search Get"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/files/categories":{"get":{"tags":["文件管理"],"summary":"获取文件类别列表","description":"获取所有文件类别及其统计信息","operationId":"get_categories_files_categories_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"additionalProperties":true,"type":"object","title":"Response Get Categories Files Categories Get"}}}}},"security":[{"HTTPBearer":[]}]}},"/files/statuses":{"get":{"tags":["文件管理"],"summary":"获取文件状态列表","description":"获取所有文件状态及其统计信息","operationId":"get_statuses_files_statuses_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"additionalProperties":true,"type":"object","title":"Response Get Statuses Files Statuses Get"}}}}},"security":[{"HTTPBearer":[]}]}},"/files/proxy_download":{"get":{"tags":["文件管理"],"summary":"通过票据代理下载（流式转发，支持 Range）","description":"校验票据，向百度直链发起请求并流式转发给前端。\n为避免阻塞，采用 requests 的流式迭代，并保留状态码/头部（含 Accept-Ranges/Content-Range）。","operationId":"proxy_download_files_proxy_download_get","security":[{"HTTPBearer":[]}],"parameters":[{"name":"ticket","in":"query","required":true,"schema":{"type":"string","description":"download_ticket 签发的票据","title":"Ticket"},"description":"download_ticket 签发的票据"},{"name":"range","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"description":"可选 Range 请求头的值，用于断点续传","title":"Range"},"description":"可选 Range 请求头的值，用于断点续传"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/files/{file_id}":{"get":{"tags":["文件管理"],"summary":"获取文件详情","description":"根据文件ID获取文件详细信息","operationId":"get_file_detail_files__file_id__get","security":[{"HTTPBearer":[]}],"parameters":[{"name":"file_id","in":"path","required":true,"schema":{"type":"integer","title":"File Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/FileInfo"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/update/check":{"post":{"tags":["更新检查"],"summary":"检查更新","description":"检查客户端是否有可用更新\n\n- **client_version**: 客户端当前版本号\n- **client_platform**: 客户端平台（web, desktop, mobile）\n- **user_agent**: 用户代理字符串（可选）","operationId":"check_update_update_check_post","requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UpdateCheckRequest"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/UpdateCheckResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}},"get":{"tags":["更新检查"],"summary":"检查更新（GET方式）","description":"通过GET方式检查更新（适用于简单的前端调用）","operationId":"check_update_get_update_check_get","parameters":[{"name":"client_version","in":"query","required":true,"schema":{"type":"string","description":"客户端版本号","title":"Client Version"},"description":"客户端版本号"},{"name":"client_platform","in":"query","required":true,"schema":{"type":"string","description":"客户端平台","title":"Client Platform"},"description":"客户端平台"},{"name":"user_agent","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"description":"用户代理","title":"User Agent"},"description":"用户代理"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/UpdateCheckResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/update/latest":{"get":{"tags":["更新检查"],"summary":"获取最新版本信息","description":"获取指定平台的最新版本信息","operationId":"get_latest_version_update_latest_get","parameters":[{"name":"platform","in":"query","required":true,"schema":{"type":"string","description":"平台类型","title":"Platform"},"description":"平台类型"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/VersionInfo"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/update/versions":{"post":{"tags":["更新检查"],"summary":"创建新版本","description":"创建新版本（需要管理员权限）","operationId":"create_version_update_versions_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/VersionCreateRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/VersionInfo"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"HTTPBearer":[]}]}},"/update/status":{"get":{"tags":["更新检查"],"summary":"更新服务状态","description":"获取更新服务状态","operationId":"get_update_status_update_status_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}}},"components":{"schemas":{"Body_upload_public_upload_post":{"properties":{"dir":{"type":"string","title":"Dir","description":"目标目录，必须在 /用户上传 下"},"file":{"type":"string","format":"binary","title":"File"},"filename":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Filename","description":"保存文件名（可选，不填用原文件名）"},"md5":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Md5","description":"可选：文件内容MD5，用于服务端前置查重"},"enrich":{"type":"boolean","title":"Enrich","description":"是否补充 file_metas 权威信息（默认否）","default":false}},"type":"object","required":["dir","file"],"title":"Body_upload_public_upload_post"},"FileInfo":{"properties":{"id":{"type":"integer","title":"Id"},"file_name":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"File Name"},"file_path":{"type":"string","title":"File Path"},"file_size":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"File Size"},"fs_id":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Fs Id"},"create_time":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Create Time"},"modify_time":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Modify Time"},"file_md5":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"File Md5"},"category":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Category"},"sync_id":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Sync Id"},"status":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Status"},"export_time":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Export Time"}},"type":"object","required":["id","file_path"],"title":"FileInfo","description":"文件信息模型"},"FileListResponse":{"properties":{"files":{"items":{"$ref":"#/components/schemas/FileInfo"},"type":"array","title":"Files"},"total":{"type":"integer","title":"Total"},"page":{"type":"integer","title":"Page"},"page_size":{"type":"integer","title":"Page Size"},"total_pages":{"type":"integer","title":"Total Pages"},"has_next":{"type":"boolean","title":"Has Next"},"has_prev":{"type":"boolean","title":"Has Prev"}},"type":"object","required":["files","total","page","page_size","total_pages","has_next","has_prev"],"title":"FileListResponse","description":"文件列表响应"},"FileStatsResponse":{"properties":{"total_files":{"type":"integer","title":"Total Files"},"total_size":{"type":"integer","title":"Total Size"},"category_stats":{"additionalProperties":{"type":"integer"},"type":"object","title":"Category Stats"},"status_stats":{"additionalProperties":{"type":"integer"},"type":"object","title":"Status Stats"},"path_stats":{"additionalProperties":{"type":"integer"},"type":"object","title":"Path Stats"}},"type":"object","required":["total_files","total_size","category_stats","status_stats","path_stats"],"title":"FileStatsResponse","description":"文件统计信息"},"HTTPValidationError":{"properties":{"detail":{"items":{"$ref":"#/components/schemas/ValidationError"},"type":"array","title":"Detail"}},"type":"object","title":"HTTPValidationError"},"LoginRequest":{"properties":{"username":{"type":"string","title":"Username"},"password":{"type":"string","title":"Password"}},"type":"object","required":["username","password"],"title":"LoginRequest"},"RefreshTokenRequest":{"properties":{"refresh_token":{"type":"string","title":"Refresh Token"}},"type":"object","required":["refresh_token"],"title":"RefreshTokenRequest"},"RegisterRequest":{"properties":{"username":{"type":"string","maxLength":64,"minLength":3,"title":"Username"},"password":{"type":"string","maxLength":128,"minLength":6,"title":"Password"}},"type":"object","required":["username","password"],"title":"RegisterRequest"},"TokenResponse":{"properties":{"access_token":{"type":"string","title":"Access Token"},"refresh_token":{"type":"string","title":"Refresh Token"},"token_type":{"type":"string","title":"Token Type","default":"bearer"}},"type":"object","required":["access_token","refresh_token"],"title":"TokenResponse"},"UpdateCheckRequest":{"properties":{"client_version":{"type":"string","title":"Client Version","description":"客户端版本号"},"client_platform":{"type":"string","title":"Client Platform","description":"客户端平台"},"user_agent":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"User Agent","description":"用户代理"}},"type":"object","required":["client_version","client_platform"],"title":"UpdateCheckRequest","description":"更新检查请求"},"UpdateCheckResponse":{"properties":{"has_update":{"type":"boolean","title":"Has Update","description":"是否有更新"},"current_version":{"type":"string","title":"Current Version","description":"当前版本"},"latest_version":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Latest Version","description":"最新版本"},"latest_version_info":{"anyOf":[{"$ref":"#/components/schemas/VersionInfo"},{"type":"null"}],"description":"最新版本信息"},"force_update":{"type":"boolean","title":"Force Update","description":"是否强制更新","default":false},"message":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Message","description":"提示信息"}},"type":"object","required":["has_update","current_version"],"title":"UpdateCheckResponse","description":"更新检查响应"},"UserOut":{"properties":{"id":{"type":"integer","title":"Id"},"username":{"type":"string","title":"Username"}},"type":"object","required":["id","username"],"title":"UserOut"},"ValidationError":{"properties":{"loc":{"items":{"anyOf":[{"type":"string"},{"type":"integer"}]},"type":"array","title":"Location"},"msg":{"type":"string","title":"Message"},"type":{"type":"string","title":"Error Type"}},"type":"object","required":["loc","msg","type"],"title":"ValidationError"},"VersionCreateRequest":{"properties":{"version":{"type":"string","title":"Version","description":"版本号"},"version_code":{"type":"integer","title":"Version Code","description":"版本代码"},"platform":{"type":"string","title":"Platform","description":"平台类型"},"release_notes":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Release Notes","description":"发布说明"},"download_url":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Download Url","description":"下载链接"},"file_size":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"File Size","description":"文件大小"},"file_hash":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"File Hash","description":"文件哈希值"},"is_force_update":{"type":"boolean","title":"Is Force Update","description":"是否强制更新","default":false},"is_latest":{"type":"boolean","title":"Is Latest","description":"是否为最新版本","default":false}},"type":"object","required":["version","version_code","platform"],"title":"VersionCreateRequest","description":"创建版本请求"},"VersionInfo":{"properties":{"version":{"type":"string","title":"Version","description":"版本号"},"version_code":{"type":"integer","title":"Version Code","description":"版本代码"},"platform":{"type":"string","title":"Platform","description":"平台类型"},"release_notes":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Release Notes","description":"发布说明"},"download_url":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Download Url","description":"下载链接"},"file_size":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"File Size","description":"文件大小"},"file_hash":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"File Hash","description":"文件哈希值"},"is_force_update":{"type":"boolean","title":"Is Force Update","description":"是否强制更新","default":false},"is_latest":{"type":"boolean","title":"Is Latest","description":"是否为最新版本","default":false},"created_at":{"type":"string","format":"date-time","title":"Created At","description":"创建时间"}},"type":"object","required":["version","version_code","platform","created_at"],"title":"VersionInfo","description":"版本信息"}},"securitySchemes":{"HTTPBearer":{"type":"http","scheme":"bearer"}}}}