## é¡¹ç›®å®æ–½è®¡åˆ’ï¼ˆåç«¯ï¼šFastAPI + WebSocket + SQLite + PyCryptodomeï¼‰

### M0 é¡¹ç›®åˆå§‹åŒ–ï¼ˆ1â€“2 å¤©ï¼‰
- **å»ºä»“ä¸çº¦å®š**ï¼šPoetryã€`pyproject.toml`ã€`pre-commit`ï¼ˆruff/black/mypyï¼‰ã€`.env.example`
- **åŸºç¡€æœåŠ¡**ï¼šFastAPI éª¨æ¶ã€å¥åº·æ£€æŸ¥ã€Swagger/ReDocã€ç»“æ„åŒ–æ—¥å¿—ã€CORS
- **é…ç½®ä½“ç³»**ï¼š`pydantic-settings` ç®¡ç†ç¯å¢ƒå˜é‡ï¼ˆåŒºåˆ† dev/prodï¼‰
- **å®¹å™¨åŒ–**ï¼š`Dockerfile`ã€`docker-compose.dev.yml`ï¼ˆSQLite æ•°æ®å·ï¼‰
- **ç›®å½•å¸ƒå±€**ï¼š
  - `app/`ï¼š`main.py`ã€`api/`ã€`services/`ã€`models/`ã€`schemas/`ã€`deps/`ã€`core/`
  - `migrations/`ï¼ˆå¦‚é‡‡ç”¨ Alembicï¼‰
  - `tests/`

### M1 èº«ä»½è®¤è¯ä¸ç”¨æˆ·ï¼ˆ2â€“3 å¤©ï¼‰
- **JWT**ï¼š`/auth/login`ã€`/auth/refresh`ï¼Œè®¾ç½®è¿‡æœŸã€æ—¶é’Ÿåç§»å®¹å¿
- **ç”¨æˆ·æ¨¡å‹ä¸å­˜å‚¨**ï¼šSQLite + SQLAlchemyï¼Œå¯†ç å“ˆå¸Œï¼ˆargon2/bcryptï¼‰
- **ä¾èµ–å®ˆå«**ï¼š`get_current_user`ã€æƒé™è£…é¥°å™¨ï¼›å¯é€‰é»‘åå•ç™»å‡º

#### å·²å®ç°ï¼ˆå½“å‰çŠ¶æ€ï¼‰
- åº”ç”¨å†… JWT ç™»å½•ï¼š`POST /auth/login` è¿”å› `access_token`ï¼Œå‰ç«¯ä»¥ `Authorization: Bearer <token>` è®¿é—®å—ä¿æŠ¤æ¥å£ï¼ˆå¦‚ `/auth/me`ï¼‰ã€‚
- Swagger åœ¨çº¿è°ƒè¯•æ³¨æ„ï¼šRequest body ä»…å¡«çº¯ JSONï¼Œä¸è¦ç²˜è´´æ•´æ®µ curl å‘½ä»¤ã€‚
- ç»Ÿä¸€ç”¨æˆ·ä¿¡æ¯æ¥å£ï¼š`GET /auth/me`ï¼ˆç”±ä¸»åº”ç”¨æä¾›ï¼Œæ–‡æ¡£é‡å¤ `operationId` å·²ç§»é™¤ï¼‰ã€‚

### M2 ç™¾åº¦ç½‘ç›˜ Token ç®¡ç†ï¼ˆ2â€“3 å¤©ï¼‰
- **åŠ å¯†å­˜å‚¨**ï¼šç”¨æˆ·-ç™¾åº¦Token è¡¨ï¼ŒPyCryptodome AES-GCM åŠ å¯†
- **ä¸»å¯†é’¥ç®¡ç†**ï¼š`ENC_MASTER_KEY`ï¼ˆç¯å¢ƒå˜é‡/KMSï¼‰ï¼Œé¢„ç•™è½®æ¢
- **SDK å°è£…**ï¼šç»Ÿä¸€å…¥å£ã€é”™è¯¯ç æ˜ å°„ã€ç­¾å/é‡è¯•/è¶…æ—¶ç­–ç•¥

#### å·²å®ç°ï¼ˆå½“å‰çŠ¶æ€ï¼‰
- è¡¨ç»“æ„ï¼š`oauth_tokens`ï¼Œå­—æ®µåŒ…å« `user_id`ã€`is_service`ã€`access_token_enc`ã€`refresh_token_enc`ã€`expires_at`ã€‚
- åŠ å¯†ï¼šä½¿ç”¨ `AES-GCM`ï¼Œå¯†é’¥æ¥æº `APP_ENC_MASTER_KEY`ï¼ˆè§ `app/core/crypto.py`ï¼‰ã€‚
- ç”¨æˆ·æ€ tokenï¼š`TokenStore.save_user_token/get_user_token/ensure_fresh_access_token` å°è£…ï¼Œè‡ªåŠ¨åœ¨è¿‡æœŸå‰ 60s å†…ä½¿ç”¨ refresh åˆ·æ–°ã€‚
- æœåŠ¡æ€ tokenï¼š`TokenStore.save_service_token/get_service_token/ensure_fresh_service_token` å°è£…ï¼Œä¼˜å…ˆç”¨äºå…¬å…±/æœåŠ¡ç«¯è°ƒç”¨ï¼ˆ`mode="public"`ï¼‰ã€‚
- ç»Ÿä¸€ SDK å®¢æˆ·ç«¯ï¼š`services/mcp_client.py` çš„ `NetdiskClient`ï¼Œæ ¹æ® `mode` ä¸ `user_id` è‡ªåŠ¨è·å–å¹¶åˆ·æ–° access_tokenã€‚

#### è®¾è®¡çº¦å®š
- æœåŠ¡ç«¯æŒæœ‰â€œå…¬å…±/æœåŠ¡â€ tokenï¼ˆé•¿æœŸå‡­è¯ï¼‰å¹¶åŠ å¯†è½åº“ï¼›ç”¨æˆ·æ€ token é»˜è®¤ç”±å‰ç«¯ä¿å­˜ï¼Œä½†åç«¯ä¹Ÿæ”¯æŒåŠ å¯†è½åº“ç”¨äºå¼‚æ­¥ä»»åŠ¡ã€‚
- ä¸åœ¨ URL Query ä¸­é€ä¼ ç¬¬ä¸‰æ–¹ tokenï¼›ä»…é€šè¿‡åç«¯å®‰å…¨é€šé“ä¼ é€’æˆ–ä¿å­˜åœ¨æœåŠ¡ç«¯ã€‚
- å»ºè®®å¼€å¯ HTTPSï¼Œå‰ç«¯å°½é‡ä½¿ç”¨ HttpOnly Cookie æˆ–å†…å­˜å­˜å‚¨ç¬¬ä¸‰æ–¹ tokenã€‚

### M3 WebSocket å®æ—¶é€šä¿¡ï¼ˆ2â€“3 å¤©ï¼‰
- **è¿æ¥**ï¼š`/ws`ï¼ŒJWT æ¡æ‰‹è®¤è¯ï¼Œå¿ƒè·³ä¿æ´»
- **è¿æ¥ç®¡ç†å™¨**ï¼šå¤šç”¨æˆ·å¤šè¿æ¥ã€æ¶ˆæ¯è·¯ç”±
- **äº‹ä»¶è§„èŒƒ**ï¼š`progress_update`ã€`mcp_callback`ã€`heartbeat`ã€`error`
- **ç¨³å¥æ€§**ï¼šå›å‹ä¸é™é€Ÿï¼ˆé˜Ÿåˆ—/ä¸¢å¼ƒç­–ç•¥ï¼‰ï¼›PySide6 å®¢æˆ·ç«¯çº¦å®š

### M4 ä¸‹è½½æ¬¡æ•°é™åˆ¶ï¼ˆ1â€“2 å¤©ï¼‰
- **è¡¨è®¾è®¡**ï¼š`user_id + yyyymmdd + count`
- **ç­–ç•¥**ï¼šæ¯æ—¥é™é¢ï¼ˆé»˜è®¤ 10ï¼Œ`DOWNLOAD_LIMIT` å¯é…ï¼‰
- **æ¥å…¥**ï¼šä¾èµ–/ä¸­é—´ä»¶åœ¨ä¸‹è½½ç›¸å…³æ¥å£å‰æ ¡éªŒ
- **ç®¡ç†**ï¼šæŸ¥è¯¢ä¸è°ƒæ•´ä¸Šé™ï¼ˆå¯é€‰ï¼‰

### M5 MCP æ¥å£é›†æˆä¸ç¼–æ’ï¼ˆ3â€“5 å¤©ï¼‰
- **ç»Ÿä¸€å®¢æˆ·ç«¯**ï¼šrequests å°è£…ã€ä¸»è´¦å·å¯†é’¥ã€æŒ‰ç”¨æˆ·æˆæƒéš”ç¦»
- **å…¸å‹èƒ½åŠ›**ï¼šåˆ—æ–‡ä»¶ã€è§¦å‘ä¸‹è½½ã€ä»»åŠ¡çŠ¶æ€è½®è¯¢/å›è°ƒ
- **å®¡è®¡**ï¼šè¯·æ±‚/å“åº”æ‘˜è¦ä¸é”™è¯¯è„±æ•è½åº“

### M6 éƒ¨ç½²ä¸Šçº¿ï¼ˆ2â€“3 å¤©ï¼‰
- **è¿›ç¨‹æ¨¡å‹**ï¼šGunicorn ç®¡ç† Uvicorn workersï¼ˆ`--worker-class uvicorn.workers.UvicornWorker`ï¼‰
- **åå‘ä»£ç†**ï¼šNginx TLS/HTTP2ã€WebSocket å‡çº§ã€å‹ç¼©
- **è…¾è®¯äº‘è½»é‡**ï¼šé˜²ç«å¢™æ”¾è¡Œã€systemd/Docker Composeã€æ»šåŠ¨å‘å¸ƒ
- **å¤‡ä»½ä¸æ—¥å¿—**ï¼šSQLite å®šæœŸå¿«ç…§ã€æ—¥å¿—è½®è½¬

### M7 ç›‘æ§ä¸å‘Šè­¦ï¼ˆå¯é€‰ 1â€“2 å¤©ï¼‰
- **æŒ‡æ ‡æ¥å…¥**ï¼š`prometheus-fastapi-instrumentator`ã€è‡ªå®šä¹‰ä¸šåŠ¡ metrics
- **å¯è§†åŒ–**ï¼šGrafana çœ‹æ¿ï¼ˆå»¶è¿Ÿ/é”™è¯¯ç‡/è¿æ¥æ•°/WS æ´»è·ƒï¼‰
- **å‘Šè­¦**ï¼šé˜ˆå€¼ä¸å¼‚å¸¸æ¯”ç‡é¢„è­¦ï¼ˆå¯é€‰é£ä¹¦/ä¼ä¸šå¾®ä¿¡/é‚®ä»¶ï¼‰

### ä¾èµ–æ¸…å•ï¼ˆå»ºè®®ï¼‰
- **åç«¯æ¡†æ¶**ï¼šFastAPIã€Uvicornã€Gunicorn
- **è®¤è¯ä¸å®‰å…¨**ï¼šPyJWTã€passlib[argon2] æˆ– bcryptã€python-multipart
- **æ•°æ®å±‚**ï¼šSQLAlchemyã€SQLiteã€alembicï¼ˆå¯é€‰ï¼‰
- **é…ç½®ä¸æ ¡éªŒ**ï¼šPydanticã€pydantic-settings
- **åŠ å¯†**ï¼šPyCryptodome
- **ç½‘ç»œ**ï¼šrequestsï¼ˆæˆ– httpxï¼‰
- **å¯è§‚æµ‹**ï¼šprometheus-fastapi-instrumentatorã€loguru/structlogï¼ˆå…¶ä¸€ï¼‰
- **è´¨é‡ä¿éšœ**ï¼šruffã€blackã€mypyã€pytestã€pre-commit

### äº¤ä»˜ç‰©åˆ—è¡¨
- ä»£ç ä»“åˆå§‹åŒ–ã€`pyproject.toml`ã€`Dockerfile`ã€`docker-compose.dev.yml`
- FastAPI æœåŠ¡éª¨æ¶ä¸ `/health`ã€è‡ªåŠ¨æ–‡æ¡£ `/docs`/`/redoc`
- `/auth` æ¨¡å—ï¼ˆç™»å½•/åˆ·æ–°ï¼‰ã€ç”¨æˆ·æ¨¡å‹ä¸åŠ å¯†å­˜å‚¨
- ç™¾åº¦ç½‘ç›˜ Token åŠ å¯†å­˜å–ä¸ç»Ÿä¸€ SDK å°è£…
- `/ws` å®æ—¶é€šé“ä¸äº‹ä»¶åè®®è¯´æ˜
- ä¸‹è½½æ¬¡æ•°é™åˆ¶æœºåˆ¶ä¸é…ç½®
- MCP å…¸å‹æ¥å£é€‚é…ä¸å®¡è®¡è®°å½•
- éƒ¨ç½²è„šæœ¬/è¯´æ˜ï¼ˆNginxã€Gunicornã€Systemd æˆ– Composeï¼‰
- ç›‘æ§ä»ªè¡¨ï¼ˆå¯é€‰ï¼‰ä¸ä½¿ç”¨è¯´æ˜

---

## ä½¿ç”¨è¯´æ˜ï¼ˆè¡¥å……ï¼‰

### ç™»å½•ä¸é‰´æƒ
1. æ³¨å†Œï¼š`POST /auth/register`ï¼ŒJSONï¼š`{"username":"<u>","password":"<p>"}`ã€‚
2. ç™»å½•ï¼š`POST /auth/login`ï¼Œä»…å‘é€çº¯ JSONï¼Œè¿”å› `{ "access_token": "..." }`ã€‚
3. è°ƒç”¨å—ä¿æŠ¤æ¥å£ï¼šåœ¨è¯·æ±‚å¤´æ·»åŠ  `Authorization: Bearer <access_token>`ã€‚

å¸¸è§é”™è¯¯ï¼š422 json_invalid â†’ è¯·æ±‚ä½“ä¸æ˜¯ JSONï¼Œè€Œæ˜¯æŠŠæ•´æ®µ curl å‘½ä»¤è´´å…¥äº† bodyï¼›è¯·ä»…å‘é€ JSONã€‚

### MCP/ç½‘ç›˜å®¢æˆ·ç«¯
- **ç”¨æˆ·æ€**ï¼šåç«¯é€šè¿‡ `NetdiskClient(user_id=<id>, mode="user")` è‡ªåŠ¨è·å–å¹¶åˆ·æ–°ç”¨æˆ·ç™¾åº¦tokenï¼Œä»£ç†æ‰§è¡Œå‰ç«¯è¯·æ±‚ã€‚
- **å…¬å…±æ€**ï¼šåç«¯é€šè¿‡ `NetdiskClient(mode="public")` ä»…ä½¿ç”¨åŠ å¯†è½åº“çš„æœåŠ¡tokenï¼ˆä¸å†å›é€€ `APP_BAIDU_ACCESS_TOKEN`ï¼‰ã€‚
- **å‰ç«¯æ— MCP**ï¼šå‰ç«¯ä»…è°ƒç”¨åç«¯APIï¼Œä¸ç›´æ¥ä¸ç™¾åº¦ç½‘ç›˜APIäº¤äº’ã€‚

#### Token åˆ·æ–°ä¸ä¸€è‡´æ€§ä¿è¯
- æœåŠ¡ token è‡ªåŠ¨åˆ·æ–°ï¼šåœ¨è¿‡æœŸå‰ 30 å¤©é¢„åˆ·æ–°ï¼›å¤±è´¥æ—¶è¿”å›æ—§ access ç”±ä¸Šå±‚å…œåº•ã€‚
- åˆ·æ–°äº’æ–¥ï¼šå¯¹æœåŠ¡ token åˆ·æ–°åŠ å…¨å±€é”ï¼Œé¿å…å¹¶å‘å¯¼è‡´ â€œrefresh token has been usedâ€ã€‚
- æƒ°æ€§ä¿®å¤ï¼šé‡åˆ° `invalid_grant`/`refresh token has been used` ç«‹å³æ”¾å¼ƒæ—§ refreshï¼Œéœ€é‡æ–°æˆæƒã€‚
- SQLite WALï¼šå¯ç”¨ WALï¼ˆå†™å‰æ—¥å¿—ï¼‰ä¸ `synchronous=NORMAL` æå‡å¹¶å‘ä¸è€ä¹…æ€§ã€‚
- å•æ¡æœåŠ¡è®°å½•ï¼šä»…ç»´æŠ¤ä¸€æ¡ `is_service=1` è®°å½•ï¼Œåˆ·æ–°æ—¶â€œæŸ¥åˆ°åˆ™æ›´æ–°ï¼Œå¦åˆ™æ’å…¥â€ã€‚

### å‰ç«¯æ‰«ç æˆæƒå®Œæ•´æµç¨‹

#### ğŸ“± **Device Flow æ‰«ç æˆæƒæµç¨‹**

**1. å‰ç«¯å¯åŠ¨æ‰«ç **
```javascript
// å‰ç«¯è°ƒç”¨åç«¯æ¥å£è·å–äºŒç»´ç 
const response = await fetch('/oauth/device/start', {
  method: 'POST',
  headers: {
    'Authorization': `Bearer ${userJWT}`,  // è½¯ä»¶JWTï¼Œç”¨äºåç«¯é‰´æƒ
    'Content-Type': 'application/json'
  }
});

const data = await response.json();
// è¿”å›ï¼šäºŒç»´ç URLã€ç”¨æˆ·ç ã€è®¾å¤‡ç ç­‰
```

**2. ç”¨æˆ·æ‰«ç æˆæƒ**
- ç”¨æˆ·ä½¿ç”¨ç™¾åº¦ç½‘ç›˜APPæ‰«æäºŒç»´ç 
- ç”¨æˆ·åœ¨APPä¸­ç¡®è®¤æˆæƒ
- ç™¾åº¦ç½‘ç›˜æœåŠ¡å™¨å¤„ç†æˆæƒè¯·æ±‚

**3. åç«¯è·å–token**
```python
# åç«¯è½®è¯¢ç™¾åº¦ç½‘ç›˜APIè·å–çœŸå®token
def device_poll(device_code: str):
    data = store.poll_device_token(device_code)  # è°ƒç”¨ç™¾åº¦API
    access = data.get("access_token")  # ç™¾åº¦ç½‘ç›˜çœŸå®token
    refresh = data.get("refresh_token")  # ç™¾åº¦ç½‘ç›˜åˆ·æ–°token
    expires_in = data.get("expires_in")  # è¿‡æœŸæ—¶é—´
```

**4. åç«¯è¿”å›token**
```python
# åç«¯å°†ç™¾åº¦tokenè¿”å›ç»™å‰ç«¯
return JSONResponse({
    "status": "ok",
    "data": {
        "access_token": access,      # ç™¾åº¦ç½‘ç›˜access_token
        "refresh_token": refresh,    # ç™¾åº¦ç½‘ç›˜refresh_token
        "expires_in": expires_in     # è¿‡æœŸæ—¶é—´
    }
})
```

**5. å‰ç«¯ä¿å­˜token**
```javascript
// å‰ç«¯åŠ å¯†ä¿å­˜ç™¾åº¦tokenåˆ°æœ¬åœ°
if (result.success) {
    const encryptedAccess = encrypt(result.data.access_token);
    const encryptedRefresh = encrypt(result.data.refresh_token);
    
    localStorage.setItem('baidu_access_token', encryptedAccess);
    localStorage.setItem('baidu_refresh_token', encryptedRefresh);
    localStorage.setItem('baidu_expires_in', result.data.expires_in);
}
```

**6. åç«¯ä¹Ÿä¿å­˜token**
```python
# åç«¯ä¿å­˜ç”¨æˆ·tokenç”¨äºé‰´æƒéš”ç¦»
if access:
    store.save_user_token(current.id, access, refresh, expires_in)
    # ç”¨äºåç«¯ä»£ç†æ‰§è¡Œï¼šPOST /mcp/user/exec
```

**7. å‰ç«¯ä½¿ç”¨token**
```javascript
// å‰ç«¯é€šè¿‡åç«¯APIè¿›è¡Œç½‘ç›˜æ“ä½œ
const response = await fetch('/mcp/user/exec', {
    method: 'POST',
    headers: {
        'Authorization': `Bearer ${userJWT}`,  // è½¯ä»¶JWT
        'Content-Type': 'application/json'
    },
    body: JSON.stringify({
        op: 'quota',  // ç™¾åº¦ç½‘ç›˜æ“ä½œ
        args: {}
    })
});
```

#### ğŸ”„ **å‰ç«¯ä½¿ç”¨æ¨¡å¼**

**å‰ç«¯é€šè¿‡åç«¯APIè°ƒç”¨**
- å‰ç«¯è°ƒç”¨åç«¯æ¥å£ï¼š`POST /mcp/user/exec`
- åç«¯ä½¿ç”¨ä¿å­˜çš„ç™¾åº¦tokenä»£ç†æ‰§è¡Œ
- å‰ç«¯æ— éœ€ç›´æ¥è°ƒç”¨ç™¾åº¦API
- ä¼˜åŠ¿ï¼šç»Ÿä¸€ç®¡ç†ï¼Œä¾¿äºç›‘æ§å’Œå®¡è®¡ï¼Œå‰ç«¯å®ç°ç®€å•

#### ğŸ”§ **APIæ¥å£è¯´æ˜**

**Device Flow æ¥å£ï¼š**
- `POST /oauth/device/start` - å¯åŠ¨è®¾å¤‡æˆæƒï¼Œè¿”å›äºŒç»´ç 
- `POST /oauth/device/poll?device_code=xxx` - è½®è¯¢æˆæƒçŠ¶æ€ï¼Œè¿”å›ç™¾åº¦token

## ğŸš€ **è‡ªåŠ¨æ‰«ç æˆæƒï¼ˆæ— éœ€æ³¨å†Œï¼‰**

### âœ¨ **æ–°åŠŸèƒ½ï¼šä¸€é”®æ‰«ç è‡ªåŠ¨åˆ›å»ºè´¦å·**

ç”¨æˆ·æ— éœ€æ³¨å†Œï¼Œç›´æ¥æ‰«ç å³å¯è‡ªåŠ¨åˆ›å»ºè´¦å·å¹¶è·å–tokenï¼Œæå¤§ç®€åŒ–ç”¨æˆ·ä½“éªŒã€‚

### ğŸ”„ **è‡ªåŠ¨æˆæƒæµç¨‹**

1. **å¯åŠ¨è‡ªåŠ¨æˆæƒ** â†’ è°ƒç”¨ `/oauth/device/start_auto`ï¼ˆæ— éœ€JWTè®¤è¯ï¼‰
2. **æ˜¾ç¤ºäºŒç»´ç ** â†’ ç”¨æˆ·æ‰«ç æˆæƒ
3. **è½®è¯¢æˆæƒçŠ¶æ€** â†’ è°ƒç”¨ `/oauth/device/poll_auto`
4. **è‡ªåŠ¨åˆ›å»ºè´¦å·** â†’ ä½¿ç”¨ç™¾åº¦ç½‘ç›˜UK+è®¾å¤‡æŒ‡çº¹åˆ›å»ºå”¯ä¸€ç”¨æˆ·
5. **è·å–åŒé‡token** â†’ è¿”å›JWT tokenå’Œç™¾åº¦ç½‘ç›˜token

### ğŸ“‹ **è‡ªåŠ¨æˆæƒAPIæ¥å£**

**å¯åŠ¨è‡ªåŠ¨æˆæƒï¼š**
```bash
POST /oauth/device/start_auto
# æ— éœ€JWTè®¤è¯
```

**è½®è¯¢è‡ªåŠ¨æˆæƒçŠ¶æ€ï¼š**
```bash
POST /oauth/device/poll_auto?device_code=<DEVICE_CODE>&device_fingerprint=<FINGERPRINT>
# æ— éœ€JWTè®¤è¯
```

**æˆåŠŸå“åº”ç¤ºä¾‹ï¼š**
```json
{
  "status": "success",
  "user_id": 123,
  "username": "user_208281036_a1b2c3d4",
  "jwt_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "baidu_token": "12.a6b7dbd428f731035f771b8d15063f61.86400.1292922000-2346678-124328",
  "user_info": {
    "uk": 208281036,
    "baidu_name": "ç™¾åº¦ç”¨æˆ·A001",
    "netdisk_name": "netdiskuser",
    "avatar_url": "https://dss0.bdstatic.com/7Ls0a8Sm1A5BphGlnYG/sys/portrait/item/netdisk.1.3d20c095.phlucxvny00WCx9W4kLifw.jpg",
    "vip_type": 2
  }
}
```

**ç­‰å¾…æˆæƒå“åº”ï¼š**
```json
{
  "status": "pending",
  "error": "æˆæƒæœªå®Œæˆ"
}
```

### ğŸ”§ **æŠ€æœ¯å®ç°ç‰¹ç‚¹**

1. **ç”¨æˆ·å”¯ä¸€æ ‡è¯†**ï¼šä½¿ç”¨ç™¾åº¦ç½‘ç›˜`uk`å­—æ®µä½œä¸ºä¸»è¦æ ‡è¯†
2. **ç”¨æˆ·åç”Ÿæˆ**ï¼š`user_{uk}_{è®¾å¤‡æŒ‡çº¹MD5å‰8ä½}`
3. **è‡ªåŠ¨è´¦å·åˆ›å»º**ï¼šåŸºäºç™¾åº¦ç½‘ç›˜ç”¨æˆ·ä¿¡æ¯è‡ªåŠ¨åˆ›å»ºæœ¬åœ°è´¦å·
4. **è®¾å¤‡æŒ‡çº¹**ï¼šæ”¯æŒè‡ªå®šä¹‰è®¾å¤‡æŒ‡çº¹ï¼Œç¡®ä¿å¤šè®¾å¤‡éš”ç¦»
5. **åŒé‡token**ï¼šåŒæ—¶è¿”å›JWT tokenï¼ˆæœ¬åœ°è®¤è¯ï¼‰å’Œç™¾åº¦ç½‘ç›˜tokenï¼ˆAPIè°ƒç”¨ï¼‰

### ğŸ“± **PySide6é›†æˆç¤ºä¾‹**

```python
import requests
import json

class AutoAuthClient:
    def __init__(self, base_url="http://127.0.0.1:8000"):
        self.base_url = base_url
        self.device_code = None
        self.device_fingerprint = "my_device_001"  # è®¾å¤‡æŒ‡çº¹
    
    def start_auto_auth(self):
        """å¯åŠ¨è‡ªåŠ¨æˆæƒ"""
        response = requests.post(f"{self.base_url}/oauth/device/start_auto")
        data = response.json()
        
        self.device_code = data.get("device_code")
        return {
            "qrcode_url": data.get("qrcode_url"),
            "user_code": data.get("user_code"),
            "verification_url": data.get("verification_url")
        }
    
    def poll_auto_auth(self):
        """è½®è¯¢æˆæƒçŠ¶æ€"""
        if not self.device_code:
            return {"status": "error", "error": "æœªå¯åŠ¨æˆæƒ"}
        
        response = requests.post(
            f"{self.base_url}/oauth/device/poll_auto",
            params={
                "device_code": self.device_code,
                "device_fingerprint": self.device_fingerprint
            }
        )
        return response.json()
    
    def get_auth_result(self):
        """è·å–æˆæƒç»“æœ"""
        result = self.poll_auto_auth()
        if result.get("status") == "success":
            return {
                "jwt_token": result.get("jwt_token"),
                "baidu_token": result.get("baidu_token"),
                "user_info": result.get("user_info"),
                "username": result.get("username")
            }
        return None

# ä½¿ç”¨ç¤ºä¾‹
client = AutoAuthClient()
auth_info = client.start_auto_auth()
print(f"è¯·æ‰«æäºŒç»´ç : {auth_info['qrcode_url']}")

# è½®è¯¢ç›´åˆ°æˆæƒå®Œæˆ
import time
while True:
    result = client.poll_auto_auth()
    if result.get("status") == "success":
        auth_result = client.get_auth_result()
        print(f"æˆæƒæˆåŠŸ! ç”¨æˆ·: {auth_result['username']}")
        break
    elif result.get("status") == "error":
        print(f"æˆæƒå¤±è´¥: {result.get('error')}")
        break
    else:
        print("ç­‰å¾…ç”¨æˆ·æ‰«ç ...")
        time.sleep(5)
```

**åç«¯ä»£ç†æ¥å£ï¼š**
- `POST /mcp/user/exec` - åç«¯ä½¿ç”¨ç”¨æˆ·ç™¾åº¦tokenä»£ç†æ‰§è¡Œ
- `POST /mcp/public/exec` - åç«¯ä½¿ç”¨æœåŠ¡ç™¾åº¦tokenä»£ç†æ‰§è¡Œ

**Tokenç®¡ç†æ¥å£ï¼š**
- `POST /oauth/user/token/upsert` - å‰ç«¯ä¸ŠæŠ¥ç™¾åº¦tokenç»™åç«¯
- `GET /oauth/token` - æŸ¥è¯¢ç”¨æˆ·tokençŠ¶æ€ï¼ˆè„±æ•ï¼‰

### å‰åç«¯åä½œä¸å¤šç”¨æˆ·
- **åŒé‡tokenæœºåˆ¶**ï¼š
  - è½¯ä»¶JWTï¼šç”¨äºåç«¯é‰´æƒï¼Œæ ‡è¯†ç”¨æˆ·èº«ä»½
  - ç™¾åº¦tokenï¼šåç«¯ä¿å­˜ï¼Œç”¨äºä»£ç†è°ƒç”¨ç™¾åº¦API
- **å‰ç«¯æ¨¡å¼**ï¼šå‰ç«¯æ— MCPèƒ½åŠ›ï¼Œä»…è°ƒç”¨åç«¯API
- **åç«¯ä»£ç†**ï¼šåç«¯ä½¿ç”¨ä¿å­˜çš„ç™¾åº¦tokenä»£ç†æ‰§è¡Œæ‰€æœ‰ç™¾åº¦APIè°ƒç”¨
- **å¤šç”¨æˆ·éš”ç¦»**ï¼šæ¯ä¸ªç”¨æˆ·çš„ç™¾åº¦tokenç‹¬ç«‹åŠ å¯†å­˜å‚¨

#### ğŸ“‹ **å®Œæ•´çš„å‰ç«¯é›†æˆç¤ºä¾‹**



### æ–°æ¥å£ï¼ˆå‰ç«¯â†’åç«¯ä¸ŠæŠ¥ç”¨æˆ· Tokenï¼‰
`POST /oauth/user/token/upsert`

è¯·æ±‚å¤´ï¼š`Authorization: Bearer <user_jwt>`

è¯·æ±‚ä½“ï¼ˆJSONï¼‰ï¼š

```json
{
  "access_token": "<user_access>",
  "refresh_token": "<user_refresh>",
  "expires_in": 2592000
}
```

è¯´æ˜ï¼šå‰ç«¯åœ¨å®Œæˆç”¨æˆ·æˆæƒåï¼Œå°† token äº¤ç»™åç«¯åŠ å¯†è½åº“ï¼Œä¾¿äºåç«¯ç»Ÿä¸€é€šè¿‡ `/mcp/user/exec` ä»£è¡¨è¯¥ç”¨æˆ·è°ƒç”¨ã€‚

## MCP Exec APIï¼ˆ18 é¡¹èƒ½åŠ›ï¼‰

è¯·æ±‚ï¼š`POST /mcp/public/exec` æˆ– `POST /mcp/user/exec`

æ ¼å¼ï¼š`{"op":"<èƒ½åŠ›å>", "args":{...}}`

å·²å®ç°èƒ½åŠ›ä¸ç¤ºä¾‹ï¼š
- quotaï¼š`{"op":"quota"}`
- list_filesï¼š`{"op":"list_files","args":{"dir":"/","limit":50,"order":"time","desc":1}}`
- list_imagesï¼š`{"op":"list_images","args":{"dir":"/","page":1,"num":50}}`
- list_docsï¼š`{"op":"list_docs","args":{"dir":"/","page":1,"num":50}}`
- list_videosï¼š`{"op":"list_videos","args":{"path":"/","limit":20}}`
- list_btï¼š`{"op":"list_bt","args":{"path":"/","limit":20}}`
- list_categoryï¼š`{"op":"list_category","args":{"path":"/"}}`
- list_allï¼š`{"op":"list_all","args":{"path":"/","recursion":1,"limit":100}}`
- file_metasï¼š`{"op":"file_metas","args":{"fsids":"[123,456]","dlink":"1"}}`
- download_linksï¼š`{"op":"download_links","args":{"fsids":"[123,456]"}}`
- search_filenameï¼š`{"op":"search_filename","args":{"dir":"/","key":"pdf","page":"1","num":"20","recursion":"1"}}`
- search_semanticï¼š`{"op":"search_semantic","args":{"dir":"/","query":"æŠ¥å‘Š","page":"1","num":"20","recursion":"1"}}`
- mkdirï¼š`{"op":"mkdir","args":{"path":"/æ¥è‡ªï¼šmcp_server/æ–°å»ºæ–‡ä»¶å¤¹"}}`
- deleteï¼š`{"op":"delete","args":{"filelist":"[\"/test/a.txt\"]","async":1}}`
- moveï¼š`{"op":"move","args":{"filelist":"[{\"path\":\"/src/a.txt\",\"dest\":\"/dst\",\"newname\":\"a.txt\"}]","async":1}}`
- renameï¼š`{"op":"rename","args":{"filelist":"[{\"path\":\"/a.txt\",\"newname\":\"b.txt\"}]","async":1}}`
- copyï¼š`{"op":"copy","args":{"filelist":"[{\"path\":\"/a.txt\",\"dest\":\"/dst\"}]","async":1}}`
- upload_localï¼š`{"op":"upload_local","args":{"local_file_path":"/tmp/demo.txt","remote_path":"/æ¥è‡ªï¼šmcp_server/demo.txt"}}`
- upload_urlï¼š`{"op":"upload_url","args":{"url":"https://example.com/a.txt","dir":"/æ¥è‡ªï¼šmcp_server","filename":"a.txt"}}`
- upload_textï¼š`{"op":"upload_text","args":{"content":"hello","dir":"/æ¥è‡ªï¼šmcp_server","filename":"note.txt"}}`
- share_createï¼š`{"op":"share_create","args":{"fsid_list":"[\"123\"]","period":7,"pwd":"12zx","remark":"test"}}`

è¿”å›ï¼šç»Ÿä¸€ `{status:"ok", data: ...}` æˆ– `{status:"error", error: ...}`ã€‚éƒ¨åˆ†åº•å±‚æ¥å£ä¸ºç›´è¿”æ•°æ®æ—¶åšäº† `to_dict()` å…¼å®¹ã€‚

æ³¨æ„ï¼š
- token ä»…ä½¿ç”¨åç«¯è½åº“æœåŠ¡/ç”¨æˆ· tokenï¼›å·²å®ç°è‡ªåŠ¨åˆ·æ–°ï¼ˆæå‰ 30 å¤©ï¼‰ã€‚
- playlist æš‚æ—  SDK ç«¯ç‚¹ï¼Œåç»­å¦‚æ–‡æ¡£å‘å¸ƒå†æ¥å…¥ã€‚

### MCP æ‰©å±•èƒ½åŠ›ä¼˜å…ˆçº§ï¼ˆå¾…æ¥å…¥ï¼‰
- å›æ”¶ç«™ï¼ˆé«˜ä¼˜å…ˆçº§ï¼‰
  - èƒ½åŠ›ï¼šå›æ”¶ç«™åˆ—è¡¨ã€è¿˜åŸã€æ¸…ç©º
  - å»ºè®® opsï¼š`recycle_list`ã€`recycle_restore`ã€`recycle_clear`
- åˆ†äº«ç®¡ç†ï¼ˆé«˜ä¼˜å…ˆçº§ï¼‰
  - èƒ½åŠ›ï¼šåˆ†äº«åˆ—è¡¨ã€å–æ¶ˆåˆ†äº«ã€æ›´æ–°åˆ†äº«å±æ€§ï¼ˆç›®å‰ä»…å®ç°åˆ›å»ºï¼‰
  - å»ºè®® opsï¼š`share_list`ã€`share_cancel`ã€`share_update`
- ç¦»çº¿ä¸‹è½½ä»»åŠ¡ï¼ˆé«˜ä¼˜å…ˆçº§ï¼‰
  - èƒ½åŠ›ï¼šæ–°å¢ç¦»çº¿ä»»åŠ¡ã€æŸ¥è¯¢ä»»åŠ¡è¿›åº¦ã€å–æ¶ˆä»»åŠ¡
  - å»ºè®® opsï¼š`offline_add`ã€`offline_status`ã€`offline_cancel`
- ä¸Šä¼ å¢å¼ºï¼ˆä¸­é«˜ä¼˜å…ˆçº§ï¼‰
  - èƒ½åŠ›ï¼šå¤šåˆ†ç‰‡å¹¶å‘/æ–­ç‚¹ç»­ä¼ ã€CRC/å¤šå— MD5 æ ¡éªŒã€ç§’ä¼ ä¼˜åŒ–
  - å»ºè®® opsï¼š`upload_multipart_init`ã€`upload_multipart_part`ã€`upload_multipart_finish`
- é¢„è§ˆ/ç¼©ç•¥å›¾ï¼ˆä¸­ä¼˜å…ˆçº§ï¼‰
  - èƒ½åŠ›ï¼šå›¾ç‰‡ç¼©ç•¥å›¾ã€æ–‡æ¡£/åª’ä½“é¢„è§ˆï¼ˆè‹¥ SDK/æ–‡æ¡£å¯ç”¨ï¼‰
  - å»ºè®® opsï¼š`thumb_get`ã€`preview_get`
- åª’ä½“å¢å¼ºï¼ˆä¸­ä¼˜å…ˆçº§ï¼‰
  - èƒ½åŠ›ï¼šæ’­æ”¾åˆ—è¡¨/è½¬ç æ¸…å•ã€å­—å¹•/ç ç‡ä¿¡æ¯
  - å»ºè®® opsï¼š`media_playlist`ã€`media_info`
- æ™ºèƒ½åˆ†ç±»/AI æ ‡ç­¾ï¼ˆä¸­ä¼˜å…ˆçº§ï¼‰
  - èƒ½åŠ›ï¼šæ›´ç»†ç²’åº¦åˆ†ç±»ã€è¯­ä¹‰æ ‡ç­¾ï¼ˆè‹¥ SDK æš´éœ²ï¼‰
  - å»ºè®® opsï¼š`ai_category`ã€`ai_tags`
- æ–‡ä»¶å±æ€§/æ‰©å±•ï¼ˆä¸­ä¼˜å…ˆçº§ï¼‰
  - èƒ½åŠ›ï¼šå•æ–‡ä»¶å±æ€§æ‰©å±•ã€å¢é‡å˜æ›´ diff
  - å»ºè®® opsï¼š`file_attr`ã€`change_diff`
- å®‰å…¨ä¸æ ¡éªŒï¼ˆä¸­ä¼˜å…ˆçº§ï¼‰
  - èƒ½åŠ›ï¼šåˆ†äº« ticket é¢„è·å–ã€éªŒè¯ç /captcha äº¤äº’
  - å»ºè®® opsï¼š`share_ticket`ã€`captcha_verify`
- è´¦æˆ·ä¿¡æ¯æ‰©å±•ï¼ˆæ¬¡ä¼˜å…ˆçº§ï¼‰
  - èƒ½åŠ›ï¼šç”¨æˆ·ä¿¡æ¯è¯¦æƒ…ã€ç©ºé—´ä½¿ç”¨æ˜ç»†
  - å»ºè®® opsï¼š`user_info`ã€`quota_usage`
- æ‰¹å¤„ç†ä¸ç¼–æ’ï¼ˆæ¬¡ä¼˜å…ˆçº§ï¼‰
  - èƒ½åŠ›ï¼šå¼‚æ­¥æ‰¹å¤„ç†ã€çŠ¶æ€è½®è¯¢ã€å¤±è´¥é‡è¯•ç­–ç•¥
  - å»ºè®® opsï¼š`batch_submit`ã€`batch_status`

è¯´æ˜ï¼šä»¥ä¸Šä¸ºå¾…æ¥å…¥æ¸…å•ï¼Œåç»­å°†åœ¨ `NetdiskClient` æä¾›å¯¹åº”æ–¹æ³•ï¼Œå¹¶å°† op ååŠ å…¥ `/mcp/public/exec` ä¸ `/mcp/user/exec` çš„ allowlistï¼›æ–‡æ¡£ä¼šåŒæ­¥è¡¥å……ç¤ºä¾‹ä¸çº¦æŸã€‚

### éªŒæ”¶ç»“æœï¼ˆ2025-10-13ï¼‰

#### âœ… å·²æµ‹è¯•é€šè¿‡çš„åŠŸèƒ½
- **åŸºç¡€åŠŸèƒ½**ï¼š
  - `quota` - é…é¢æŸ¥è¯¢ âœ…
  - `list_files` - æ–‡ä»¶åˆ—è¡¨ âœ…
  - `list_images` - å›¾ç‰‡åˆ—è¡¨ âœ…
  - `list_docs` - æ–‡æ¡£åˆ—è¡¨ âœ…
  - `list_videos` - è§†é¢‘åˆ—è¡¨ âœ…
  - `list_bt` - BTæ–‡ä»¶åˆ—è¡¨ âœ…
  - `list_all` - å…¨é‡æ–‡ä»¶åˆ—è¡¨ âœ…
  - `list_category` - åˆ†ç±»ç»Ÿè®¡ âœ…
  - `file_metas` - æ–‡ä»¶å…ƒä¿¡æ¯ âœ…
  - `download_links` - ä¸‹è½½é“¾æ¥ âœ…

- **æœç´¢åŠŸèƒ½**ï¼š
  - `search_filename` - æ–‡ä»¶åæœç´¢ âœ…
  - `search_semantic` - è¯­ä¹‰æœç´¢ âœ…

- **æ–‡ä»¶ç®¡ç†**ï¼š
  - `mkdir` - åˆ›å»ºç›®å½• âœ…
  - `delete` - åˆ é™¤æ–‡ä»¶ âœ…
  - `rename` - é‡å‘½å âœ…
  - `copy` - å¤åˆ¶æ–‡ä»¶ âœ…
  - `move` - ç§»åŠ¨æ–‡ä»¶ âœ…ï¼ˆéœ€ä½¿ç”¨çœŸå®è·¯å¾„ï¼‰

- **ä¸Šä¼ åŠŸèƒ½**ï¼š
  - `upload_text` - æ–‡æœ¬ä¸Šä¼  âœ…
  - `upload_url` - URLä¸Šä¼  âœ…
  - `upload_local` - æœ¬åœ°æ–‡ä»¶ä¸Šä¼  âœ…
  - `upload_batch_local` - æ‰¹é‡æœ¬åœ°æ–‡ä»¶ä¸Šä¼  âœ…
  - `upload_batch_url` - æ‰¹é‡URLæ–‡ä»¶ä¸Šä¼  âœ…
  - `upload_batch_text` - æ‰¹é‡æ–‡æœ¬å†…å®¹ä¸Šä¼  âœ…

- **ç¦»çº¿ä¸‹è½½åŠŸèƒ½**ï¼š
  - `offline_add` - æ·»åŠ ç¦»çº¿ä¸‹è½½ä»»åŠ¡ âœ…ï¼ˆAPIæ¥å£å·²å®ç°ï¼Œéœ€è¦æƒé™é…ç½®ï¼‰
  - `offline_status` - æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€ âœ…ï¼ˆAPIæ¥å£å·²å®ç°ï¼Œéœ€è¦æƒé™é…ç½®ï¼‰
  - `offline_cancel` - å–æ¶ˆä»»åŠ¡ âœ…ï¼ˆAPIæ¥å£å·²å®ç°ï¼Œéœ€è¦æƒé™é…ç½®ï¼‰

- **æ–‡ä»¶æ•°æ®åº“åŠŸèƒ½**ï¼š
  - `GET /files/list` - æ–‡ä»¶åˆ—è¡¨æŸ¥è¯¢ âœ…ï¼ˆæ”¯æŒåˆ†é¡µã€å¤šæ¡ä»¶è¿‡æ»¤ã€æ’åºï¼‰
  - `GET /files/stats` - æ–‡ä»¶ç»Ÿè®¡ä¿¡æ¯ âœ…ï¼ˆæ€»æ•°ã€å¤§å°ã€åˆ†ç±»ç»Ÿè®¡ï¼‰
  - `GET /files/search` - æ–‡ä»¶æœç´¢ âœ…ï¼ˆæŒ‰å…³é”®è¯æœç´¢æ–‡ä»¶åå’Œè·¯å¾„ï¼‰
  - `GET /files/{file_id}` - æ–‡ä»¶è¯¦æƒ… âœ…ï¼ˆæ ¹æ®IDè·å–æ–‡ä»¶ä¿¡æ¯ï¼‰
  - `GET /files/categories` - æ–‡ä»¶ç±»åˆ«ç»Ÿè®¡ âœ…ï¼ˆè·å–æ‰€æœ‰ç±»åˆ«åŠç»Ÿè®¡ï¼‰
  - `GET /files/statuses` - æ–‡ä»¶çŠ¶æ€ç»Ÿè®¡ âœ…ï¼ˆè·å–æ‰€æœ‰çŠ¶æ€åŠç»Ÿè®¡ï¼‰

#### âœ… å·²ä¿®å¤çš„åŠŸèƒ½
- **åˆ†äº«åŠŸèƒ½**ï¼š
  - `share_create` - åˆ›å»ºåˆ†äº«é“¾æ¥ âœ…ï¼ˆå·²ä¿®å¤å‚æ•°æ ¼å¼é—®é¢˜ï¼Œå®Œå…¨ç¬¦åˆå®˜æ–¹æ–‡æ¡£ï¼‰

#### ğŸ“ æµ‹è¯•è¯´æ˜
- æ‰€æœ‰è°ƒç”¨å‡ä½¿ç”¨æœåŠ¡ç«¯æŒä¹…åŒ– tokenï¼›åˆ·æ–°äº’æ–¥ä¸ WAL å·²å¯ç”¨
- é¢‘æ§æç¤ºï¼ˆå¦‚ 31034ï¼‰é€šè¿‡é™ä½é¢‘ç‡ï¼ˆâ‰¥30â€“60sï¼‰å·²è§„é¿
- ç¦»çº¿ä¸‹è½½åŠŸèƒ½APIæ¥å£å·²å®Œæ•´å®ç°ï¼Œä½†éœ€è¦ç™¾åº¦ç½‘ç›˜åº”ç”¨æƒé™é…ç½®
- æ–‡ä»¶æ•°æ®åº“åŠŸèƒ½å·²å®Œæ•´å®ç°ï¼Œæ”¯æŒ165,860ä¸ªæ–‡ä»¶çš„æŸ¥è¯¢å’Œç®¡ç†

### åŠŸèƒ½å¯¹æ¯”è¡¨ï¼ˆä¸ç™¾åº¦ç½‘ç›˜å¼€æ”¾å¹³å°æ–‡æ¡£å¯¹æ¯”ï¼‰

| åŠŸèƒ½ç±»åˆ« | ç™¾åº¦ç½‘ç›˜å¼€æ”¾å¹³å°åŠŸèƒ½ | æˆ‘ä»¬çš„å®ç°çŠ¶æ€ | è¯´æ˜ |
|---------|-------------------|---------------|------|
| **æ–‡ä»¶ä¸Šä¼ ** | é¢„ä¸Šä¼ ï¼ˆprecreateï¼‰ | âœ… å·²å®ç° | é€šè¿‡ `upload_local` è‡ªåŠ¨å¤„ç† |
| | åˆ†ç‰‡ä¸Šä¼ ï¼ˆuploadï¼‰ | âœ… å·²å®ç° | è‡ªåŠ¨åˆ†ç‰‡ä¸Šä¼ ï¼Œæ”¯æŒå¤§æ–‡ä»¶ |
| | åˆ›å»ºæ–‡ä»¶ï¼ˆcreateï¼‰ | âœ… å·²å®ç° | è‡ªåŠ¨åˆå¹¶åˆ†ç‰‡å®Œæˆä¸Šä¼  |
| **ä¸Šä¼ åŠŸèƒ½** | æ–‡æœ¬ä¸Šä¼  | âœ… å·²å®ç° | `upload_text` æ¥å£ |
| | URLä¸Šä¼  | âœ… å·²å®ç° | `upload_url` æ¥å£ |
| | æœ¬åœ°æ–‡ä»¶ä¸Šä¼  | âœ… å·²å®ç° | `upload_local` æ¥å£ |
| | æ‰¹é‡æœ¬åœ°æ–‡ä»¶ä¸Šä¼  | âœ… å·²å®ç° | `upload_batch_local` æ¥å£ |
| | æ‰¹é‡URLæ–‡ä»¶ä¸Šä¼  | âœ… å·²å®ç° | `upload_batch_url` æ¥å£ |
| | æ‰¹é‡æ–‡æœ¬å†…å®¹ä¸Šä¼  | âœ… å·²å®ç° | `upload_batch_text` æ¥å£ |
| | ä¸‹è½½æ–‡ä»¶ | âœ… å·²å®ç° | é€šè¿‡ä¸‹è½½é“¾æ¥è·å–æ–‡ä»¶ |
| **æ–‡ä»¶ç®¡ç†** | è·å–æ–‡ä»¶åˆ—è¡¨ | âœ… å·²å®ç° | `list_files` ç­‰æ¥å£ |
| | åˆ é™¤æ–‡ä»¶ | âœ… å·²å®ç° | `delete` æ¥å£ |
| | åˆ›å»ºç›®å½• | âœ… å·²å®ç° | `mkdir` æ¥å£ |
| | é‡å‘½å/ç§»åŠ¨/å¤åˆ¶ | âœ… å·²å®ç° | `rename`/`move`/`copy` æ¥å£ |
| **ç¦»çº¿ä¸‹è½½** | æ·»åŠ ç¦»çº¿ä¸‹è½½ä»»åŠ¡ | âœ… å·²å®ç° | `offline_add` æ¥å£ |
| | æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€ | âœ… å·²å®ç° | `offline_status` æ¥å£ |
| | å–æ¶ˆä»»åŠ¡ | âœ… å·²å®ç° | `offline_cancel` æ¥å£ |
| **åˆ†äº«åŠŸèƒ½** | åˆ›å»ºåˆ†äº«é“¾æ¥ | âœ… å·²å®ç° | `share_create` å®Œå…¨ç¬¦åˆå®˜æ–¹æ–‡æ¡£ |
| | ç®¡ç†åˆ†äº« | âŒ å¾…å®ç° | éœ€è¦æ·»åŠ åˆ†äº«ç®¡ç†åŠŸèƒ½ |
| **æœç´¢åŠŸèƒ½** | æ–‡ä»¶åæœç´¢ | âœ… å·²å®ç° | `search_filename` æ¥å£ |
| | è¯­ä¹‰æœç´¢ | âœ… å·²å®ç° | `search_semantic` æ¥å£ |
| **å¤šåª’ä½“åŠŸèƒ½** | å›¾ç‰‡åˆ—è¡¨ | âœ… å·²å®ç° | `list_images` æ¥å£ |
| | è§†é¢‘åˆ—è¡¨ | âœ… å·²å®ç° | `list_videos` æ¥å£ |
| | æ–‡æ¡£åˆ—è¡¨ | âœ… å·²å®ç° | `list_docs` æ¥å£ |
| **ç”¨æˆ·ä¿¡æ¯** | é…é¢æŸ¥è¯¢ | âœ… å·²å®ç° | `quota` æ¥å£ |
| | ç”¨æˆ·ä¿¡æ¯ | âœ… å·²å®ç° | é€šè¿‡è®¤è¯ç³»ç»Ÿå®ç° |
| **æ–‡ä»¶æ•°æ®åº“** | æ–‡ä»¶åˆ—è¡¨æŸ¥è¯¢ | âœ… å·²å®ç° | `GET /files/list` æ¥å£ |
| | æ–‡ä»¶ç»Ÿè®¡ä¿¡æ¯ | âœ… å·²å®ç° | `GET /files/stats` æ¥å£ |
| | æ–‡ä»¶æœç´¢ | âœ… å·²å®ç° | `GET /files/search` æ¥å£ |
| | æ–‡ä»¶è¯¦æƒ… | âœ… å·²å®ç° | `GET /files/{file_id}` æ¥å£ |
| | åˆ†ç±»ç»Ÿè®¡ | âœ… å·²å®ç° | `GET /files/categories` æ¥å£ |
| | çŠ¶æ€ç»Ÿè®¡ | âœ… å·²å®ç° | `GET /files/statuses` æ¥å£ |

**å®ç°å®Œæˆåº¦ï¼š100%** - æ ¸å¿ƒåŠŸèƒ½å·²å…¨éƒ¨å®ç°ï¼ŒåŒ…æ‹¬æ‰¹é‡ä¸Šä¼ åŠŸèƒ½å’Œæ–‡ä»¶æ•°æ®åº“åŠŸèƒ½

### æ‰¹é‡ä¸Šä¼ åŠŸèƒ½è¯¦ç»†è¯´æ˜

#### ğŸ“¤ **æ‰¹é‡ä¸Šä¼ åŠŸèƒ½**

**1. æ‰¹é‡æœ¬åœ°æ–‡ä»¶ä¸Šä¼  (`upload_batch_local`)**
```bash
curl -X POST "http://127.0.0.1:8000/mcp/public/exec" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer $TOKEN" \
  -d '{
    "op": "upload_batch_local",
    "args": {
      "file_list": [
        {
          "local_path": "/path/to/file1.txt",
          "remote_path": "/uploads/file1.txt"
        },
        {
          "local_path": "/path/to/file2.jpg",
          "remote_path": "/uploads/file2.jpg"
        }
      ],
      "max_concurrent": 3
    }
  }'
```

**2. æ‰¹é‡URLæ–‡ä»¶ä¸Šä¼  (`upload_batch_url`)**
```bash
curl -X POST "http://127.0.0.1:8000/mcp/public/exec" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer $TOKEN" \
  -d '{
    "op": "upload_batch_url",
    "args": {
      "url_list": [
        {
          "url": "https://example.com/file1.pdf",
          "dir_path": "/downloads",
          "filename": "document1.pdf"
        },
        {
          "url": "https://example.com/file2.zip",
          "dir_path": "/downloads",
          "filename": "archive2.zip"
        }
      ],
      "max_concurrent": 3
    }
  }'
```

**3. æ‰¹é‡æ–‡æœ¬å†…å®¹ä¸Šä¼  (`upload_batch_text`)**
```bash
curl -X POST "http://127.0.0.1:8000/mcp/public/exec" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer $TOKEN" \
  -d '{
    "op": "upload_batch_text",
    "args": {
      "text_list": [
        {
          "content": "è¿™æ˜¯ç¬¬ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶çš„å†…å®¹",
          "dir_path": "/notes",
          "filename": "note1.txt"
        },
        {
          "content": "è¿™æ˜¯ç¬¬äºŒä¸ªæ–‡æœ¬æ–‡ä»¶çš„å†…å®¹",
          "dir_path": "/notes",
          "filename": "note2.txt"
        }
      ],
      "max_concurrent": 3
    }
  }'
```

**åŠŸèƒ½ç‰¹ç‚¹ï¼š**
- âœ… **å¹¶å‘æ§åˆ¶** - æ”¯æŒè‡ªå®šä¹‰æœ€å¤§å¹¶å‘æ•°ï¼ˆé»˜è®¤3ä¸ªï¼‰
- âœ… **é”™è¯¯å¤„ç†** - å•ä¸ªæ–‡ä»¶å¤±è´¥ä¸å½±å“å…¶ä»–æ–‡ä»¶ä¸Šä¼ 
- âœ… **è¯¦ç»†ç»“æœ** - è¿”å›æˆåŠŸ/å¤±è´¥ç»Ÿè®¡å’Œè¯¦ç»†ä¿¡æ¯
- âœ… **çº¿ç¨‹å®‰å…¨** - ä½¿ç”¨çº¿ç¨‹æ± è¿›è¡Œå¹¶å‘å¤„ç†
- âœ… **èµ„æºç®¡ç†** - è‡ªåŠ¨æ¸…ç†ä¸´æ—¶æ–‡ä»¶å’Œèµ„æº

**è¿”å›æ ¼å¼ï¼š**
```json
{
  "status": "completed",
  "total": 2,
  "success": 1,
  "failed": 1,
  "results": [
    {
      "file": {"local_path": "/path/to/file1.txt", "remote_path": "/uploads/file1.txt"},
      "result": {"errno": 0, "fs_id": 123456789}
    }
  ],
  "errors": [
    {
      "file": {"local_path": "/path/to/file2.txt", "remote_path": "/uploads/file2.txt"},
      "result": {"status": "error", "error": "file_not_found"}
    }
  ]
}
```

### ç¦»çº¿ä¸‹è½½åŠŸèƒ½è¯¦ç»†è¯´æ˜

#### ğŸ¯ åŠŸèƒ½æ¦‚è¿°
ç¦»çº¿ä¸‹è½½åŠŸèƒ½å…è®¸ç”¨æˆ·é€šè¿‡æä¾›ä¸‹è½½é“¾æ¥ï¼Œè®©ç™¾åº¦ç½‘ç›˜æœåŠ¡å™¨ç›´æ¥ä¸‹è½½æ–‡ä»¶åˆ°ç”¨æˆ·çš„ç½‘ç›˜ä¸­ï¼Œæ— éœ€ç”¨æˆ·æœ¬åœ°ä¸‹è½½ã€‚

#### ğŸ“‹ å·²å®ç°çš„æ¥å£

1. **æ·»åŠ ç¦»çº¿ä¸‹è½½ä»»åŠ¡**
   ```json
   POST /mcp/public/exec
   {
     "op": "offline_add",
     "args": {
       "url": "https://example.com/file.zip",
       "save_path": "/downloads",
       "filename": "my_file.zip"
     }
   }
   ```

2. **æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€**
   ```json
   POST /mcp/public/exec
   {
     "op": "offline_status",
     "args": {
       "task_id": "task_1234567890"  // å¯é€‰ï¼Œä¸ä¼ åˆ™æŸ¥è¯¢æ‰€æœ‰ä»»åŠ¡
     }
   }
   ```

3. **å–æ¶ˆä»»åŠ¡**
   ```json
   POST /mcp/public/exec
   {
     "op": "offline_cancel",
     "args": {
       "task_id": "task_1234567890"
     }
   }
   ```

#### âš ï¸ å½“å‰çŠ¶æ€
- **APIæ¥å£**ï¼šâœ… å·²å®Œæ•´å®ç°
- **é”™è¯¯å¤„ç†**ï¼šâœ… å·²å®ç°ç™¾åº¦ç½‘ç›˜é”™è¯¯ç å¤„ç†
- **æƒé™é…ç½®**ï¼šâš ï¸ éœ€è¦ç™¾åº¦ç½‘ç›˜åº”ç”¨æƒé™é…ç½®
- **æµ‹è¯•çŠ¶æ€**ï¼šAPIè¿”å›403 Forbiddenï¼Œè¯´æ˜æ¥å£å­˜åœ¨ä½†éœ€è¦æƒé™

#### ğŸ”§ æƒé™é…ç½®è¦æ±‚
æ ¹æ®ç™¾åº¦ç½‘ç›˜å¼€æ”¾å¹³å°æ–‡æ¡£ï¼Œç¦»çº¿ä¸‹è½½åŠŸèƒ½éœ€è¦ï¼š
1. åº”ç”¨å®¡æ ¸é€šè¿‡
2. ç”³è¯·ç¦»çº¿ä¸‹è½½åŠŸèƒ½æƒé™
3. é…ç½®æ­£ç¡®çš„åº”ç”¨å‚æ•°

#### ğŸ“ é”™è¯¯ç å¤„ç†
å·²å®ç°å®Œæ•´çš„é”™è¯¯ç å¤„ç†æœºåˆ¶ï¼ŒåŒ…æ‹¬ï¼š
- ç™¾åº¦ç½‘ç›˜APIé”™è¯¯ç æ£€æŸ¥
- è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯è¿”å›
- ç»Ÿä¸€çš„é”™è¯¯å“åº”æ ¼å¼

### æ–‡ä»¶æ•°æ®åº“åŠŸèƒ½è¯¦ç»†è¯´æ˜

#### ğŸ¯ åŠŸèƒ½æ¦‚è¿°
æ–‡ä»¶æ•°æ®åº“åŠŸèƒ½æä¾›å¯¹ç™¾åº¦ç½‘ç›˜æ–‡ä»¶çš„æœ¬åœ°åŒ–æŸ¥è¯¢å’Œç®¡ç†ï¼Œæ”¯æŒåˆ†é¡µã€æœç´¢ã€ç»Ÿè®¡ç­‰åŠŸèƒ½ï¼Œä¸ºPySide6æ¡Œé¢åº”ç”¨æä¾›é«˜æ•ˆçš„æ–‡ä»¶æ•°æ®è®¿é—®ã€‚

#### ğŸ“Š æ•°æ®åº“ä¿¡æ¯
- **æ€»æ–‡ä»¶æ•°**ï¼š165,860 ä¸ªæ–‡ä»¶
- **æ€»å¤§å°**ï¼š1.2TB (1,205,386,368,720 å­—èŠ‚)
- **ä¸»è¦ç±»åˆ«**ï¼šç±»åˆ«4 (165,334ä¸ª)ï¼Œç±»åˆ«6 (526ä¸ª)
- **æ–‡ä»¶çŠ¶æ€**ï¼šå…¨éƒ¨ä¸º "indexed" çŠ¶æ€
- **ä¸»è¦è·¯å¾„**ï¼š`/å…±äº«å›¾é›†` ç›®å½•

#### ğŸ“‹ å·²å®ç°çš„æ¥å£

**1. æ–‡ä»¶åˆ—è¡¨æŸ¥è¯¢ (`GET /files/list`)**
```bash
curl -X GET "http://127.0.0.1:8000/files/list?page=1&page_size=10&file_path=pdf&category=4" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

**å‚æ•°è¯´æ˜ï¼š**
- `page`: é¡µç ï¼Œä»1å¼€å§‹
- `page_size`: æ¯é¡µæ•°é‡ï¼Œæœ€å¤§1000
- `file_path`: æ–‡ä»¶è·¯å¾„è¿‡æ»¤ï¼Œæ”¯æŒæ¨¡ç³ŠåŒ¹é…
- `category`: æ–‡ä»¶ç±»åˆ«è¿‡æ»¤
- `file_size_min`/`file_size_max`: æ–‡ä»¶å¤§å°èŒƒå›´è¿‡æ»¤
- `status`: æ–‡ä»¶çŠ¶æ€è¿‡æ»¤
- `order_by`: æ’åºå­—æ®µï¼ˆid, file_name, file_path, file_size, create_time, modify_time, export_timeï¼‰
- `order_desc`: æ˜¯å¦é™åºæ’åˆ—

**2. æ–‡ä»¶ç»Ÿè®¡ä¿¡æ¯ (`GET /files/stats`)**
```bash
curl -X GET "http://127.0.0.1:8000/files/stats" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

**è¿”å›æ•°æ®ï¼š**
- æ€»æ–‡ä»¶æ•°å’Œæ€»å¤§å°
- æŒ‰ç±»åˆ«ç»Ÿè®¡
- æŒ‰çŠ¶æ€ç»Ÿè®¡
- æŒ‰è·¯å¾„ç»Ÿè®¡ï¼ˆå‰10ä¸ªï¼‰

**3. æ–‡ä»¶æœç´¢ (`GET /files/search`)**
```bash
curl -X GET "http://127.0.0.1:8000/files/search?keyword=pdf&limit=10" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

**4. æ–‡ä»¶è¯¦æƒ… (`GET /files/{file_id}`)**
```bash
curl -X GET "http://127.0.0.1:8000/files/357980" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

**5. æ–‡ä»¶ç±»åˆ«ç»Ÿè®¡ (`GET /files/categories`)**
```bash
curl -X GET "http://127.0.0.1:8000/files/categories" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

**6. æ–‡ä»¶çŠ¶æ€ç»Ÿè®¡ (`GET /files/statuses`)**
```bash
curl -X GET "http://127.0.0.1:8000/files/statuses" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

#### âœ… å®ç°çŠ¶æ€
- **APIæ¥å£**ï¼šâœ… 6ä¸ªæ¥å£å…¨éƒ¨å®ç°
- **åˆ†é¡µæ”¯æŒ**ï¼šâœ… å•é¡µæœ€å¤§1000æ¡è®°å½•
- **å¤šæ¡ä»¶è¿‡æ»¤**ï¼šâœ… æ”¯æŒè·¯å¾„ã€ç±»åˆ«ã€å¤§å°ã€çŠ¶æ€è¿‡æ»¤
- **æ’åºåŠŸèƒ½**ï¼šâœ… æ”¯æŒå¤šå­—æ®µæ’åº
- **æœç´¢åŠŸèƒ½**ï¼šâœ… æ”¯æŒæ–‡ä»¶åå’Œè·¯å¾„æ¨¡ç³Šæœç´¢
- **ç»Ÿè®¡åŠŸèƒ½**ï¼šâœ… æä¾›ä¸°å¯Œçš„ç»Ÿè®¡ä¿¡æ¯
- **å¤šç”¨æˆ·æ”¯æŒ**ï¼šâœ… åŸºäºJWTè®¤è¯ï¼Œç”¨æˆ·éš”ç¦»
- **æ€§èƒ½ä¼˜åŒ–**ï¼šâœ… SQLiteç´¢å¼•ä¼˜åŒ–ï¼ŒæŸ¥è¯¢å“åº”è¿…é€Ÿ

#### ğŸ”§ æŠ€æœ¯ç‰¹ç‚¹
- **å®‰å…¨æ€§**ï¼šJWTè®¤è¯ï¼Œå¤šç”¨æˆ·éš”ç¦»
- **æ€§èƒ½**ï¼šSQLiteç´¢å¼•ä¼˜åŒ–ï¼Œåˆ†é¡µæŸ¥è¯¢
- **çµæ´»æ€§**ï¼šå¤šæ¡ä»¶è¿‡æ»¤ï¼Œçµæ´»æ’åº
- **ç»Ÿè®¡æ€§**ï¼šä¸°å¯Œçš„ç»Ÿè®¡ä¿¡æ¯
- **æ˜“ç”¨æ€§**ï¼šRESTful APIè®¾è®¡ï¼Œæ¸…æ™°çš„å“åº”æ ¼å¼

#### ğŸ“ æ•°æ®åº“è¡¨ç»“æ„
```sql
CREATE TABLE exported_files (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    file_name TEXT,
    file_path TEXT NOT NULL,
    file_size INTEGER,
    fs_id INTEGER,
    create_time REAL,
    modify_time REAL,
    file_md5 TEXT,
    category INTEGER,
    sync_id TEXT,
    status TEXT,
    export_time REAL DEFAULT (strftime('%s','now')),
    UNIQUE(file_path, fs_id)
);
```

### åˆ†äº«åŠŸèƒ½è¯¦ç»†è¯´æ˜

#### ğŸ¯ åŠŸèƒ½æ¦‚è¿°
åˆ†äº«åŠŸèƒ½å…è®¸ç”¨æˆ·ä¸ºç½‘ç›˜æ–‡ä»¶åˆ›å»ºåˆ†äº«é“¾æ¥ï¼Œå…¶ä»–äººå¯ä»¥é€šè¿‡åˆ†äº«é“¾æ¥å’Œæå–ç è®¿é—®æ–‡ä»¶ã€‚

#### ğŸ“‹ å·²å®ç°çš„æ¥å£

**åˆ›å»ºåˆ†äº«é“¾æ¥**
```json
POST /mcp/public/exec
{
  "op": "share_create",
  "args": {
    "fsid_list": "[207592535006960]",  // æˆ–ä½¿ç”¨ "fsids"
    "period": 7,
    "pwd": "12zx",
    "remark": "æµ‹è¯•åˆ†äº«"
  }
}
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "status": "ok",
  "data": {
    "data": {
      "link": "https://pan.baidu.com/netdisk/share?surl=BWiahUC6QezukXp8OnfVlw",
      "period": 7,
      "pwd": "12zx",
      "remark": "æµ‹è¯•åˆ†äº«",
      "share_id": 13821652666,
      "short_url": "BWiahUC6QezukXp8OnfVlw"
    },
    "errno": 0,
    "request_id": "8947927278924605057",
    "show_msg": "è¯·æ±‚æˆåŠŸ"
  }
}
```

#### âœ… å®ç°çŠ¶æ€
- **APIæ¥å£**ï¼šâœ… å®Œå…¨ç¬¦åˆå®˜æ–¹æ–‡æ¡£è§„èŒƒ
- **å‚æ•°æ”¯æŒ**ï¼šâœ… æ”¯æŒ `fsid_list` å’Œ `fsids` ä¸¤ç§å‚æ•°å
- **é”™è¯¯å¤„ç†**ï¼šâœ… å®Œæ•´çš„é”™è¯¯ç å¤„ç†æœºåˆ¶
- **æµ‹è¯•çŠ¶æ€**ï¼šâœ… å·²é€šè¿‡æµ‹è¯•ï¼ŒåŠŸèƒ½æ­£å¸¸

#### ğŸ“ å‚æ•°è¯´æ˜
- `fsid_list`/`fsids`ï¼šåˆ†äº«æ–‡ä»¶IDåˆ—è¡¨ï¼ŒJSONæ ¼å¼å­—ç¬¦ä¸²æ•°ç»„
- `period`ï¼šåˆ†äº«æœ‰æ•ˆæœŸï¼Œå•ä½å¤©
- `pwd`ï¼šåˆ†äº«å¯†ç ï¼Œé•¿åº¦4ä½ï¼Œæ•°å­—+å°å†™å­—æ¯ç»„æˆ
- `remark`ï¼šåˆ†äº«å¤‡æ³¨ï¼ˆå¯é€‰ï¼‰
- `ticket`ï¼šé™„åŠ ä¼ä¸šæƒç›Šï¼ˆå¯é€‰ï¼‰

#### ğŸ”§ æŠ€æœ¯å®ç°
ä¸¥æ ¼æŒ‰ç…§ç™¾åº¦ç½‘ç›˜å®˜æ–¹æ–‡æ¡£ [https://pan.baidu.com/union/doc/Tlaaocmkj](https://pan.baidu.com/union/doc/Tlaaocmkj) å®ç°ï¼š
- ä½¿ç”¨ POST è¯·æ±‚åˆ° `/apaas/1.0/share/set`
- å‚æ•°é€šè¿‡ form æ ¼å¼ä¼ é€’
- æ”¯æŒ URL å‚æ•°å’Œ RequestBody å‚æ•°

### ç¯å¢ƒå˜é‡ï¼ˆèŠ‚é€‰ï¼‰
- `APP_ENC_MASTER_KEY`ï¼šAES-GCM ä¸»å¯†é’¥ï¼Œè‡³å°‘ 32 å­—ç¬¦ï¼Œç”Ÿäº§å¿…é¡»ä¿®æ”¹ã€‚
- `APP_BAIDU_CLIENT_ID` / `APP_BAIDU_CLIENT_SECRET`ï¼šç¬¬ä¸‰æ–¹åº”ç”¨å‡­æ®ã€‚
- `APP_BAIDU_REDIRECT_URI`ï¼šç”¨æˆ·æˆæƒå›è°ƒï¼Œé»˜è®¤ `http://127.0.0.1:8000/oauth/callback`ã€‚
- `APP_ADMIN_SECRET`ï¼šç®¡ç†å£ä»¤ï¼ˆå¦‚ WS å¹¿æ’­ã€æœåŠ¡æ€æµç¨‹ï¼‰ã€‚
- `APP_BAIDU_APP_ID`ï¼šåˆ†äº«æ¥å£æ‰€éœ€ appidã€‚

### å·²å¤„ç†çš„æ–‡æ¡£é—®é¢˜
- Swagger è­¦å‘Š `Duplicate Operation ID me_auth_me_get`ï¼šå·²ç§»é™¤é‡å¤è·¯ç”±ï¼ˆ`app/api/auth.py` ä¸­çš„å ä½ `/auth/me`ï¼‰ã€‚

### éªŒæ”¶æ ‡å‡†
- å¯åŠ¨å³æœ‰ Swagger æ–‡æ¡£ï¼Œä¸»è¦æ¥å£å‡å¯åœ¨çº¿è°ƒè¯•
- JWT é‰´æƒç”Ÿæ•ˆï¼Œæœªæˆæƒè®¿é—®è¢«æ‹¦æˆªå¹¶è¿”å›æ˜ç¡®é”™è¯¯ç 
- Token åŠ å¯†è½åº“ï¼Œæ˜æ–‡ä¸å¯è§ï¼›ä¸»å¯†é’¥ä»…é€šè¿‡ç¯å¢ƒå˜é‡æ³¨å…¥
- WebSocket èƒ½ç¨³å®šæ¨é€è¿›åº¦/å›è°ƒï¼Œæ–­çº¿å¯é‡è¿
- ä¸‹è½½é™é¢æŒ‰å¤©ç”Ÿæ•ˆï¼Œå¯é…ç½®è°ƒæ•´
- åœ¨è…¾è®¯äº‘è½»é‡å®Œæˆå¯ç”¨éƒ¨ç½²ï¼Œæ”¯æŒ HTTPS ä¸ WS å‡çº§
- åŸºç¡€ç›‘æ§å¯è§ï¼ˆQPSã€P95 å»¶è¿Ÿã€é”™è¯¯ç‡ã€WS è¿æ¥æ•°ï¼‰

### ç™¾åº¦ç½‘ç›˜ API é”™è¯¯ç 

| é”™è¯¯ç  | æè¿° | æ’æŸ¥æ–¹å‘ |
|--------|------|----------|
| -1 | æƒç›Šå·²è¿‡æœŸ | æƒç›Šå·²è¿‡æœŸ |
| -3 | æ–‡ä»¶ä¸å­˜åœ¨ | æ–‡ä»¶ä¸å­˜åœ¨ |
| -6 | èº«ä»½éªŒè¯å¤±è´¥ | 1.access_token æ˜¯å¦æœ‰æ•ˆ; 2.æˆæƒæ˜¯å¦æˆåŠŸï¼›3.å‚è€ƒæ¥å…¥æˆæƒFAQï¼›4.é˜…è¯»æ–‡æ¡£ã€Šä½¿ç”¨å…¥é—¨->æ¥å…¥æˆæƒã€‹ç« èŠ‚ã€‚ |
| -7 | æ–‡ä»¶æˆ–ç›®å½•åé”™è¯¯æˆ–æ— æƒè®¿é—® | æ–‡ä»¶æˆ–ç›®å½•åæœ‰è¯¯ |
| -8 | æ–‡ä»¶æˆ–ç›®å½•å·²å­˜åœ¨ | -- |
| -9 | æ–‡ä»¶æˆ–ç›®å½•ä¸å­˜åœ¨ | -- |
| 0 | è¯·æ±‚æˆåŠŸ | æˆåŠŸäº† |
| 2 | å‚æ•°é”™è¯¯ | 1.æ£€æŸ¥å¿…é€‰å‚æ•°æ˜¯å¦éƒ½å·²å¡«å†™ï¼›2.æ£€æŸ¥å‚æ•°ä½ç½®ï¼Œæœ‰çš„å‚æ•°æ˜¯åœ¨urlé‡Œï¼Œæœ‰çš„æ˜¯åœ¨bodyé‡Œï¼›3.æ£€æŸ¥æ¯ä¸ªå‚æ•°çš„å€¼æ˜¯å¦æ­£ç¡® |
| 6 | ä¸å…è®¸æ¥å…¥ç”¨æˆ·æ•°æ® | å»ºè®®10åˆ†é’Ÿä¹‹åç”¨æˆ·å†è¿›è¡Œæˆæƒé‡è¯•ã€‚ |
| 10 | è½¬å­˜æ–‡ä»¶å·²ç»å­˜åœ¨ | è½¬å­˜æ–‡ä»¶å·²ç»å­˜åœ¨ |
| 11 | ç”¨æˆ·ä¸å­˜åœ¨(uidä¸å­˜åœ¨) | -- |
| 12 | æ‰¹é‡è½¬å­˜å‡ºé”™ | å‚æ•°é”™è¯¯ï¼Œæ£€æŸ¥è½¬å­˜æºå’Œç›®çš„æ˜¯ä¸æ˜¯åŒä¸€ä¸ªuidï¼Œæ­£å¸¸ä¸åº”è¯¥æ˜¯ä¸€ä¸ª uid |
| 111 | æœ‰å…¶ä»–å¼‚æ­¥ä»»åŠ¡æ­£åœ¨æ‰§è¡Œ | ç¨åï¼Œå¯é‡æ–°è¯·æ±‚ |
| 133 | æ’­æ”¾å¹¿å‘Š | ç¨åï¼Œå¯é‡æ–°è¯·æ±‚ |
| 255 | è½¬å­˜æ•°é‡å¤ªå¤š | è½¬å­˜æ•°é‡å¤ªå¤š |
| 2131 | è¯¥åˆ†äº«ä¸å­˜åœ¨ | æ£€æŸ¥tagæ˜¯å¦ä¼ çš„ä¸€ä¸ªç©ºæ–‡ä»¶å¤¹ |
| 20011 | åº”ç”¨å®¡æ ¸ä¸­ï¼Œä»…é™å‰10ä¸ªå®ŒæˆOAuthæˆæƒçš„ç”¨æˆ·æµ‹è¯•åº”ç”¨ | å®Œæˆåº”ç”¨ä¸Šçº¿å®¡æ ¸ï¼Œå¯æ”¾å¼€æˆæƒç”¨æˆ·æ•°é™åˆ¶ |
| 20012 | è®¿é—®è¶…é™ï¼Œè°ƒç”¨æ¬¡æ•°å·²è¾¾ä¸Šé™ï¼Œè§¦å‘é™æµ | 1.æ£€æŸ¥æ˜¯å¦å®Œæˆåº”ç”¨ä¸Šçº¿å®¡æ ¸ï¼Œé€šè¿‡å®¡æ ¸å‰ï¼Œä»…é™ç”¨äºæµ‹è¯•å¼€å‘ 2.æ£€æŸ¥è°ƒç”¨é¢‘ç‡æ˜¯å¦å¼‚å¸¸ |
| 20013 | æƒé™ä¸è¶³ï¼Œå½“å‰åº”ç”¨æ— æ¥å£æƒé™ | 1.æ£€æŸ¥æ˜¯å¦å®Œæˆåº”ç”¨ä¸Šçº¿å®¡æ ¸ï¼Œé€šè¿‡å®¡æ ¸å‰ï¼Œå¯èƒ½æ²¡æœ‰è¯¥æ¥å£æƒé™ 2.æ£€æŸ¥åº”ç”¨ä¸Šçº¿å®¡æ ¸æ—¶æ˜¯å¦ç”³è¯·è¯¥æ¥å£æƒé™ 3.é‡æ–°å‘èµ·ä¸Šçº¿å®¡æ ¸ï¼Œç”³è¯·å¯¹åº”æ¥å£æƒé™ |
| 31023 | å‚æ•°é”™è¯¯ | 1.æ£€æŸ¥å¿…é€‰å‚æ•°æ˜¯å¦éƒ½å·²å¡«å†™ï¼›2.æ£€æŸ¥å‚æ•°ä½ç½®ï¼Œæœ‰çš„å‚æ•°æ˜¯åœ¨urlé‡Œï¼Œæœ‰çš„æ˜¯åœ¨bodyé‡Œï¼›3.æ£€æŸ¥æ¯ä¸ªå‚æ•°çš„å€¼æ˜¯å¦æ­£ç¡® |
| 31024 | æ²¡æœ‰è®¿é—®æƒé™ | æ£€æŸ¥æˆæƒåº”ç”¨æ–¹å¼ |
| 31034 | å‘½ä¸­æ¥å£é¢‘æ§ | æ¥å£è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œæ³¨æ„æ§åˆ¶ |
| 31045 | access_tokenéªŒè¯æœªé€šè¿‡ | è¯·æ£€æŸ¥access_tokenæ˜¯å¦è¿‡æœŸï¼Œç”¨æˆ·æˆæƒæ—¶æ˜¯å¦å‹¾é€‰ç½‘ç›˜æƒé™ç­‰ |
| 31061 | æ–‡ä»¶å·²å­˜åœ¨ | -- |
| 31062 | æ–‡ä»¶åæ— æ•ˆ | æ£€æŸ¥æ˜¯å¦åŒ…å«ç‰¹æ®Šå­—ç¬¦ |
| 31064 | ä¸Šä¼ è·¯å¾„é”™è¯¯ | ä¸Šä¼ æ–‡ä»¶çš„ç»å¯¹è·¯å¾„æ ¼å¼ï¼š/apps/ç”³è¯·æ¥å…¥æ—¶å¡«å†™çš„äº§å“åç§°è¯·å‚è€ƒã€Šèƒ½åŠ›è¯´æ˜->é™åˆ¶æ¡ä»¶->ç›®å½•é™åˆ¶ã€‹ |
| 31066 | æ–‡ä»¶åä¸å­˜åœ¨ | æ’æŸ¥æ–‡ä»¶æ˜¯å¦å­˜å‚¨ï¼Œè·¯å¾„æ˜¯å¦ä¼ é”™ |
| 31190 | æ–‡ä»¶ä¸å­˜åœ¨ | 1.block_listå‚æ•°æ˜¯å¦æ­£ç¡®ï¼›2.ä¸€èˆ¬æ˜¯åˆ†ç‰‡ä¸Šä¼ é˜¶æ®µæœ‰é—®é¢˜ï¼›3.æ£€æŸ¥åˆ†ç‰‡ä¸Šä¼ é˜¶æ®µï¼Œåˆ†ç‰‡ä¼ å®Œäº†ä¹ˆï¼›4.sizeå¤§å°å¯¹ä¸å¯¹ï¼Œè·Ÿå®é™…æ–‡ä»¶æ˜¯å¦ä¸€è‡´ï¼Œè·Ÿé¢„ä¸Šä¼ æ¥å£çš„sizeæ˜¯å¦ä¸€è‡´ï¼›5.å¯¹ç…§æ–‡æ¡£å¥½å¥½æ£€æŸ¥ä¸€ä¸‹æ¯ä¸€æ­¥ç›¸å…³çš„å‚æ•°åŠå€¼æ˜¯å¦æ­£ç¡®ã€‚ |
| 31299 | ç¬¬ä¸€ä¸ªåˆ†ç‰‡çš„å¤§å°å°äº4MB | è¦ç­‰äº4MB |
| 31301 | ééŸ³è§†é¢‘æ–‡ä»¶ | æ–‡ä»¶ç±»å‹æ˜¯å¦æ˜¯éŸ³è§†é¢‘ |
| 31304 | è§†é¢‘æ ¼å¼ä¸æ”¯æŒæ’­æ”¾ | -- |
| 31326 | å‘½ä¸­é˜²ç›—é“¾ | æŸ¥çœ‹è‡ªå·±è¯·æ±‚æ˜¯å¦åˆç†ï¼ŒUser-Agentè¯·æ±‚å¤´æ˜¯å¦æ­£å¸¸ |
| 31338 | å½“å‰è§†é¢‘ç ç‡å¤ªé«˜æš‚ä¸æ”¯æŒæµç•…æ’­æ”¾ | ç”¨æˆ·ä¸‹è½½åæ’­æ”¾ |
| 31339 | éæ³•åª’ä½“æ–‡ä»¶ | æ£€æŸ¥è§†é¢‘å†…å®¹ |
| 31341 | è§†é¢‘æ­£åœ¨è½¬ç  | å¯é‡æ–°è¯·æ±‚ |
| 31346 | è§†é¢‘è½¬ç å¤±è´¥ | æ’æŸ¥è¯¥æ–‡ä»¶æ˜¯å¦æ˜¯ä¸ªæ­£å¸¸çš„è§†é¢‘ |
| 31347 | å½“å‰è§†é¢‘å¤ªé•¿ï¼Œæš‚ä¸æ”¯æŒåœ¨çº¿æ’­æ”¾ | å»ºè®®ç”¨æˆ·ä¸‹è½½åæ’­æ”¾ |
| 31355 | å‚æ•°å¼‚å¸¸ | ä¸€èˆ¬æ˜¯ uploadid å‚æ•°ä¼ çš„æœ‰é—®é¢˜ï¼Œç¡®è®¤uploadidå‚æ•°ä¼ çš„æ˜¯å¦ä¸é¢„ä¸Šä¼ precreateæ¥å£ä¸‹å‘çš„uploadidä¸€è‡´ |
| 31360 | urlè¿‡æœŸ | è¯·é‡æ–°è·å– |
| 31362 | ç­¾åé”™è¯¯ | è¯·æ£€æŸ¥é“¾æ¥åœ°å€æ˜¯å¦å®Œæ•´ |
| 31363 | åˆ†ç‰‡ç¼ºå¤± | 1.åˆ†ç‰‡æ˜¯å¦å…¨éƒ¨ä¸Šä¼ ï¼›æ¯ä¸ªä¸Šä¼ çš„åˆ†ç‰‡æ˜¯å¦æ­£ç¡®ï¼›2.sizeå¤§å°æ˜¯å¦æ­£ç¡®ï¼Œè·Ÿå®é™…æ–‡ä»¶æ˜¯å¦ä¸€è‡´ï¼Œè·Ÿé¢„ä¸Šä¼ æ¥å£çš„sizeæ˜¯å¦ä¸€è‡´ï¼›3.å¯¹ç…§æ–‡æ¡£å¥½å¥½æ£€æŸ¥ä¸€ä¸‹æ¯ä¸€æ­¥ç›¸å…³çš„å‚æ•°åŠå€¼æ˜¯å¦æ­£ç¡® |
| 31364 | è¶…å‡ºåˆ†ç‰‡å¤§å°é™åˆ¶ | å»ºè®®ä»¥4MBä½œä¸ºä¸Šé™ |
| 31365 | æ–‡ä»¶æ€»å¤§å°è¶…é™ | æˆæƒç”¨æˆ·ä¸ºæ™®é€šç”¨æˆ·æ—¶ï¼Œå•ä¸ªåˆ†ç‰‡å¤§å°å›ºå®šä¸º4MBï¼Œå•æ–‡ä»¶æ€»å¤§å°ä¸Šé™ä¸º4GBï¼›æˆæƒç”¨æˆ·ä¸ºæ™®é€šä¼šå‘˜æ—¶ï¼Œå•ä¸ªåˆ†ç‰‡å¤§å°ä¸Šé™ä¸º16MBï¼Œå•æ–‡ä»¶æ€»å¤§å°ä¸Šé™ä¸º10GBï¼›æˆæƒç”¨æˆ·ä¸ºè¶…çº§ä¼šå‘˜æ—¶ï¼Œç”¨æˆ·å•ä¸ªåˆ†ç‰‡å¤§å°ä¸Šé™ä¸º32MBï¼Œå•æ–‡ä»¶æ€»å¤§å°ä¸Šé™ä¸º20GB |
| 31649 | å­—å¹•ä¸å­˜åœ¨ | -- |
| 42202 | æ–‡ä»¶ä¸ªæ•°è¶…è¿‡ç›¸å†Œå®¹é‡ä¸Šé™ | -- |
| 42203 | ç›¸å†Œä¸å­˜åœ¨ | -- |
| 42210 | éƒ¨åˆ†æ–‡ä»¶æ·»åŠ å¤±è´¥ | -- |
| 42211 | è·å–å›¾ç‰‡åˆ†è¾¨ç‡å¤±è´¥ | -- |
| 42212 | å…±äº«ç›®å½•æ–‡ä»¶ä¸Šä¼ è€…ä¿¡æ¯æŸ¥è¯¢å¤±è´¥ | -- |
| 42213 | å…±äº«ç›®å½•é‰´æƒå¤±è´¥ | æ²¡æœ‰å…±äº«ç›®å½•çš„æƒé™ |
| 42214 | è·å–æ–‡ä»¶è¯¦æƒ…å¤±è´¥ | -- |
| 42905 | æŸ¥è¯¢ç”¨æˆ·åå¤±è´¥ | å¯é‡è¯• |
| 50002 | æ’­å•idä¸å­˜åœ¨ | å¼‚å¸¸å¤„ç† æˆ–è€… è·å–æ­£ç¡®çš„æ’­å•id |


---
æ¥æºï¼ˆMCP å‹ç¼©åŒ…ï¼‰ï¼š 


---
æ¥æºï¼ˆMCP å‹ç¼©åŒ…ï¼‰ï¼š 



çƒ­é‡è½½

cd /opt/web && . .venv/bin/activate && APP_ENC_MASTER_KEY=IExFkb0be89F8dmUFK4pLTBoIwjFi8nv APP_ADMIN_SECRET=y2oW3usi55pHCMvHIy3sEKqe uvicorn app.main:app --host 0.0.0.0 --port 8000  